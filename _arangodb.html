<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="author" content="Jan Aerts">
<title>Data Management</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_arangodb" class="article toc2 toc-left">
<div id="header">
<h1>Data Management</h1>
<div class="details">
<span id="author" class="author">Jan Aerts</span><br>
<span id="email" class="email"><a href="mailto:jan.aerts@uhasselt.be">jan.aerts@uhasselt.be</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="index.html">Data Management</a></span></p><ul class="sectlevel1">
<li><a href="_relational_database_management_systems.html">1. Relational Database Management Systems</a>
</li>
<li><a href="_nosql_an_introduction.html">2. NoSQL: an introduction</a>
</li>
<li><a href="_keyvalue_stores.html">3. Key/value stores</a>
</li>
<li><a href="_document_oriented_databases.html">4. Document-oriented databases</a>
</li>
<li><a href="_graph_databases.html">5. Graph databases</a>
</li>
<li><a href="_arangodb.html"><span class="toc-current">6. ArangoDB</span></a>
<ul class="sectlevel2">
<li><a href="_arangodb.html#_a_multi_model_database">6.1. A multi-model database</a>
</li>
<li><a href="_arangodb.html#_starting_with_arangodb">6.2. Starting with ArangoDB</a>
</li>
<li><a href="_arangodb.html#_loading_data">6.3. Loading data</a>
</li>
<li><a href="_arangodb.html#_querying_keyvalue_data">6.4. Querying key/value data</a>
</li>
<li><a href="_arangodb.html#_querying_document_data">6.5. Querying document data</a>
</li>
<li><a href="_arangodb.html#_querying_graph_data">6.6. Querying graph data</a>
</li>
<li><a href="_arangodb.html#_improving_performance">6.7. Improving performance</a>
</li>
</ul>
</li>
<li><a href="_arangodb_apis.html">7. ArangoDB APIs</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_arangodb">6. ArangoDB</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_multi_model_database">6.1. A multi-model database</h3>
<div class="paragraph">
<p>As for RDBMS, there are many different implementations of document-oriented databases. Unfortunately, as the NoSQL field is much younger than the RDBMS area, things have not settled enough so that standards are formed. In the RDBMS world, there are many implementations such as Oracle, MySQL, PostgreSQL, Microsoft Access, etc, but they all conform to the same standard for querying their data: SQL. In the NoSQL world, however, this is very different and different implementations use very different query languages. For example, a search in the document store MongoDB (which is widely used) looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">db.individuals.findAll({ethnicity: "African"}, {genotypes: 1})</code></pre>
</div>
</div>
<div class="paragraph">
<p>whereas it would look like this in ArangoDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR i IN individuals
FILTER i.ethnicity = 'African'
RETURN i.genotypes</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same is true for graph databases. A query in the popular Neo4j database can look like this (in what is called the <em>cypher</em> language):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">MATCH (a)-[:WORKS_FOR]-&gt;(b:Company {name: "Microsoft"}) RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>would be the following in <em>gremlin</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">g.V().out('works_for').inV().hasLabel("Company").has("name", "Microsoft")</code></pre>
</div>
</div>
<div class="paragraph">
<p>whereas it would look like this in ArangoDB (in <em>AQL</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN individuals
  FOR v,e,p IN 1..1 OUTBOUND a GRAPH 'works_for'
    FILTER v.name = 'Microsoft'
    RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Further in this post we&#8217;ll be using <a href="https://www.arangodb.com/">ArangoDB</a> as our database, because - for this course - we can then at least stick with <em>one</em> query language.</p>
</div>
</div>
<div class="sect2">
<h3 id="_starting_with_arangodb">6.2. Starting with ArangoDB</h3>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb-positioning.png" alt="arangodb positioning"></span></p>
</div>
<div class="sect3">
<h4 id="_installation">6.2.1. Installation</h4>
<div class="paragraph">
<p>The easiest way to install ArangoDB is to download it from <a href="https://www.arangodb.com/download-major/">here</a>. Make sure to check the Installation Manual:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for Windows: <a href="https://www.arangodb.com/docs/stable/installation-windows.html" class="bare">https://www.arangodb.com/docs/stable/installation-windows.html</a></p>
</li>
<li>
<p>for MacOS: <a href="https://www.arangodb.com/docs/stable/installation-mac-osx.html" class="bare">https://www.arangodb.com/docs/stable/installation-mac-osx.html</a> &#8658; probably easiest to use the second option and install it using the .dmg package</p>
</li>
<li>
<p>linux: installation options available for CentOS, Fedora, Redhat, Debian, Ubuntu, SuSE and ArchLinux</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For getting started with ArangoDB, see <a href="https://www.arangodb.com/docs/stable/getting-started.html" class="bare">https://www.arangodb.com/docs/stable/getting-started.html</a>. Some of the following is extracted from that documentation. After installing ArangoDB, you can access the web interface at <a href="http://localhost:8529" class="bare">http://localhost:8529</a>; log in as user <code>root</code> (without a password) and connect to the <code>_system</code> database. (Note that in a real setup, the root user would only be used for administrative purposes, and you would first create a new username. For the sake of simplicity, we&#8217;ll take a shortcut here.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_web_interface_vs_arangosh">6.2.2. Web interface vs arangosh</h4>
<div class="paragraph">
<p>In the context of this course, we will use the web interface for ArangoDB. Although very easy to use, it does have some shortcomings compared to the command line <code>arangosh</code>, or using ArangoDB from within programs written in python or other languages. For example, we won&#8217;t be able to run centrality queries using the web interface. If you&#8217;re even a little bit serious about using databases, you should get yourself acquainted with the shell as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_loading_data">6.3. Loading data</h3>
<div class="sect3">
<h4 id="_document_data">6.3.1. Document data</h4>
<div class="paragraph">
<p>Let&#8217;s load some data. Download the list of airports in the US from <a href="http://vda-lab.github.io/assets/airports.json" class="bare">http://vda-lab.github.io/assets/airports.json</a>. This file looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{"_key": "00M", "name": "Thigpen ", "city": "Bay Springs", "state": "MS", "country": "USA",
 "lat": 31.95376472, "long": -89.23450472, "vip": false}
{"_key": "00R", "name": "Livingston Municipal", "city": "Livingston", "state": "TX", "country": "USA",
 "lat": 30.68586111, "long": -95.01792778, "vip": false}
{"_key": "00V", "name": "Meadow Lake", "city": "Colorado Springs", "state": "CO", "country": "USA",
 "lat": 38.94574889, "long": -104.5698933, "vip": false}
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember from above that document databases often use JSON as their format. To load this into ArangoDB:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new collection (<code>Collections</code> &#8594; <code>Add Collection</code>) with the name <code>airports</code>. The <code>type</code> should be <code>document</code>. <span class="image"><img src="assets/arangodb_createcollection.png" alt="arangodb createcollection"></span></p>
</li>
<li>
<p>Click on the collection, and then the <code>Upload documents from JSON file</code> button at the top.
<span class="image"><img src="assets/arangodb_upload.png" alt="arangodb upload"></span></p>
</li>
<li>
<p>Select the <code>airports.json</code> file that you just downloaded onto your computer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You should end up with something like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_airports.png" alt="arangodb airports"></span></p>
</div>
<div class="paragraph">
<p>Notice that every document has a <code>_key</code> defined.</p>
</div>
</div>
<div class="sect3">
<h4 id="_link_data">6.3.2. Link data</h4>
<div class="paragraph">
<p>In addition to <code>_key</code>, ArangoDB documents can have other special keys. In a graph context, links are nothing more than regular documents, but which have a <code>_from</code> and <code>_to</code> key to refer to other documents that are the nodes. So links in ArangoDB are basically also just documents, but with the special keys <code>_from</code> and <code>_to</code>. This means that we can also query them as documents (which is what we will actually do later.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/nodes_and_link.png" alt="nodes and link"></span></p>
</div>
<div class="paragraph">
<p>We have a flight dataset, that you can download from <a href="http://vda-lab.github.io/assets/flights.json" class="bare">http://vda-lab.github.io/assets/flights.json</a>. Similar to loading the airports dataset, we go to the <code>Collections</code> page in the webinterface, and click <code>Upload</code>. This time, however, we need to set the type to <code>Edge</code> rather than <code>Document</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_createcollection_edges.png" alt="arangodb createcollection edges"></span></p>
</div>
<div class="paragraph">
<p>This is what a single flight looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">{
  "_key": "1834", "_id": "flights/1834",
  "_from": "airports/ATL", "_to": "airports/CHS", "_rev": "_ZRp7f-S---",
  "Year": 2008, "Month": 1, "Day": 1, "DayOfWeek": 2,
  "DepTimeUTC": "2008-01-01T05:02:00.000Z", "ArrTimeUTC": "2008-01-01T05:57:00.000Z",
  "UniqueCarrier": "FL", "FlightNum": 579, "TailNum": "N937AT", "Distance": 259
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_querying_keyvalue_data">6.4. Querying key/value data</h3>
<div class="paragraph">
<p>As mentioned above, key/value stores are very quick for returning documents given a certain key. ArangoDB can be used as a key/value store as well. Remember from above that a key/value store should only do these things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a document with a given key</p>
</li>
<li>
<p>Return a document given a key</p>
</li>
<li>
<p>Delete a document given a key</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s try these out. But before we do so, it&#8217;d be cleaner if we created a new collection just for this purpose. Go to <code>Collections</code> and create a new collection named <code>keyvalues</code>.</p>
</div>
<div class="paragraph">
<p>ArangoDB uses its own query language, called <code>AQL</code>, to access the data in the different collections. Go to the <code>Queries</code> section in the web interface.</p>
</div>
<div class="sect3">
<h4 id="_creating_a_keyvalue_pair">6.4.1. Creating a key/value pair</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">INSERT {_key: "a", value: "some text"} INTO keyvalues</code></pre>
</div>
</div>
<div class="paragraph">
<p>This created our first key/value pair! The value can be anything, as we mentioned above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">INSERT {_key: "b", value: [1,2,3,4,5]} INTO keyvalues
INSERT {_key: "c", value: {first: 1, second: 2}} INTO keyvalues</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can only do <em>one</em> insert at a time in the ArangoDB webinterface. So to insert both, you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR i in [
    { "_key": "b", "value": [1,2,3,4,5] },
    { "_key": "c", "value": {first: 1, second: 2} }]
INSERT i IN keyvalues</code></pre>
</div>
</div>
<div class="paragraph">
<p>(We&#8217;ll come back to the <code>FOR</code> loop etc in the next section.)</p>
</div>
</div>
<div class="sect3">
<h4 id="_retrieving_a_keyvalue_pair">6.4.2. Retrieving a key/value pair</h4>
<div class="paragraph">
<p>To retrieve a document given a certain key (in this case &#8220;c&#8221;), we can run the query</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">RETURN DOCUMENT('keyvalues/c').value</code></pre>
</div>
</div>
<div class="paragraph">
<p>How this works will get much more clear as we move further down in this post&#8230;&#8203;</p>
</div>
</div>
<div class="sect3">
<h4 id="_removing_a_keyvalue_pair">6.4.3. Removing a key/value pair</h4>
<div class="paragraph">
<p>To remove a key/value pair (e.g. the pair for key <code>b</code>), we run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">REMOVE 'b' IN keyvalues</code></pre>
</div>
</div>
<div class="paragraph">
<p>Retrieving and removing key/value pairs are very fast in ArangoDB, because the <code>_key</code> attribute is indexed by default.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_querying_document_data">6.5. Querying document data</h3>
<div class="paragraph">
<p>Having stored our data in the <code>airports</code> and <code>flights</code> collections, we can query these in the <code>Query</code> section. An overview of the possible high-level operations can be found here: <a href="https://www.arangodb.com/docs/stable/aql/operations.html" class="bare">https://www.arangodb.com/docs/stable/aql/operations.html</a>. From that website:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FOR</code>: Iterate over a collection or View, all elements of an array or traverse a graph</p>
</li>
<li>
<p><code>RETURN</code>: Produce the result of a query.</p>
</li>
<li>
<p><code>FILTER</code>: Restrict the results to elements that match arbitrary logical conditions.</p>
</li>
<li>
<p><code>SEARCH</code>: Query the (full-text) index of an ArangoSearch View</p>
</li>
<li>
<p><code>SORT</code>: Force a sort of the array of already produced intermediate results.</p>
</li>
<li>
<p><code>LIMIT</code>: Reduce the number of elements in the result to at most the specified number, optionally skip elements (pagination).</p>
</li>
<li>
<p><code>LET</code>: Assign an arbitrary value to a variable.</p>
</li>
<li>
<p><code>COLLECT</code>: Group an array by one or multiple group criteria. Can also count and aggregate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll go over some of these below.</p>
</div>
<div class="paragraph">
<p>Note: When in the following section I write something like "equivalent in SQL" with an actual SQL query, this will actually be hypothetical. In other words: you cannot run that actual query on the ArangoDB database as that would not work. It <em>would</em> work if you&#8217;d first make an SQL database (e.g. using sqlite as seen in the previous session) and created the necessary tables and rows&#8230;&#8203;</p>
</div>
<div class="sect3">
<h4 id="_returning_a_result">6.5.1. `RETURN`ing a result</h4>
<div class="paragraph">
<p>The most straightforward way to get a document is to select it by key. When doing this, you have to prepend the key with the name of the collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">RETURN DOCUMENT("airports/JFK")</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above basically treats the ArangoDB database as a key/value store.</p>
</div>
<div class="paragraph">
<p>You can also get multiple documents if you provide an array of keys instead of a single one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">RETURN DOCUMENT(["airports/JFK","airports/03D"])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the square brackets around the keys!</p>
</div>
</div>
<div class="sect3">
<h4 id="_for_looping_over_all_documents">6.5.2. <code>FOR</code>: Looping over all documents</h4>
<div class="paragraph">
<p>Remember that in SQL, a query looked like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT state
FROM airports
WHERE lat &gt; 35;</code></pre>
</div>
</div>
<div class="paragraph">
<p>SQL is a <em>declarative</em> language, which means that you tell the RDBMS <em>what</em> you want, not <em>how</em> to get it. This is not exactly true for AQL, which does need you to specify that you want to loop over all documents. The same query as the SQL one above in AQL would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.lat &gt; 35
  RETURN a.state</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, the minimal SQL query is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT * FROM airports;</code></pre>
</div>
</div>
<div class="paragraph">
<p>, whereas the minimal AQL query is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can nest <code>FOR</code> statements, in which case you&#8217;ll get the cross project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN [1,2,3]
  FOR b IN [10,20,30]
    RETURN [a, b]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">1  10
2  10
3  10
1  20
2  20
3  20
1  30
2  30
3  30</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_projections">6.5.3. Projections</h4>
<div class="paragraph">
<p>If you don&#8217;t want to return the whole document, you can specify this in the <code>RETURN</code> statement. This is called a <em>projection</em>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  RETURN a.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apart from a single value per document, we can also return arrays or maps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  RETURN [a.name, a.state]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  RETURN { "name": a.name, "state": a.state }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to specifying the column names in an SQL query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT name, state
FROM airports;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_returning_only_distinct_results">6.5.4. Returning only <code>DISTINCT</code> results</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  RETURN DISTINCT a.state</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filtering_documents">6.5.5. `FILTER`ing documents</h4>
<div class="paragraph">
<p>Data can be filtered using <code>FILTER</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>To combine different filters, you can use <code>AND</code> and <code>OR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  AND a.vip == true
  RETURN a</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  OR a.vip == true
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is often recommended to use parentheses to clarify the order of the filters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER ( a.state == 'CA' OR a.vip == true )
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of <code>AND</code>, you can also apply multiple filters consecutively:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  FILTER a.vip == true
  RETURN a</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
All steps in the <code>FOR</code> loop are executed from top to bottom. So the order in which they appear is important (see further).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sorting_the_results">6.5.6. `SORT`ing the results</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  SORT a.lat
  RETURN [ a.name, a.lat ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>As in SQL, AQL allows you do sort in descending order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  SORT a.lat DESC
  RETURN [ a.name, a.lat ]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_combining_different_filters_limits_etc">6.5.7. Combining different filters, limits, etc</h4>
<div class="paragraph">
<p>Remember that in SQL, you can combine different filters, sortings etc.</p>
</div>
<div class="paragraph">
<p>In SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT * FROM airports
WHERE a.state = 'CA'
AND a.lat &gt; 20
AND vip = true
SORT BY lat
LIMIT 15;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In AQL, the different filters, sorts, limits, etc are applied top to bottom, so order is important! This means that the following two do not necessarily give the same results.</p>
</div>
<div class="paragraph">
<p>Here are 2 versions (one correct, one wrong) of a query to get (max) 5 airports in California with a VIP lounge.
===== Version 1</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  FILTER a.state == 'CA'
  LIMIT 5
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s break this down step by step and see what we get in the intermediate phases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">_key</th>
<th class="tableblock halign-left valign-top">_id</th>
<th class="tableblock halign-left valign-top">_rev</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">city</th>
<th class="tableblock halign-left valign-top">state</th>
<th class="tableblock halign-left valign-top">country</th>
<th class="tableblock halign-left valign-top">lat</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">vip</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/AMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxW-Aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amarillo International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amarillo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.2193725</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-101.7059272</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ATL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxa-_E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">William B Hartsfield-Atlanta Intl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atlanta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.64044444</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-84.42694444</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/DFW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxu&#8212;&#8203;I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dallas-Fort Worth International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dallas-Fort Worth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32.89595056</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-97.0372</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JFK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/JFK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyK-Aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John F Kennedy Intl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New York</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40.63975111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-73.77892556</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyS-_c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.94253611</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-118.4080744</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyq-AS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chicago O&#8217;Hare International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chicago</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">41.979595</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-87.90446417</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKz&#8212;&#8203;A-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">San Francisco International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">San Francisco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">37.61900194</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-122.3748433</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We see that there are 7 airports in the US with a VIP lounge. Let&#8217;s add the second filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  FILTER a.state == 'CA'
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">_key</th>
<th class="tableblock halign-left valign-top">_id</th>
<th class="tableblock halign-left valign-top">_rev</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">city</th>
<th class="tableblock halign-left valign-top">state</th>
<th class="tableblock halign-left valign-top">country</th>
<th class="tableblock halign-left valign-top">lat</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">vip</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyS-_c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.94253611</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-118.4080744</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKz&#8212;&#8203;A-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">San Francisco International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">San Francisco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">37.61900194</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-122.3748433</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Finally, we limit the output to a maximum of 5 records, but we only have 2 anyway&#8230;&#8203;</p>
</div>
<div class="sect4">
<h5 id="_version_2">Version 2</h5>
<div class="paragraph">
<p>In the second version, we switched the <code>FILTER a.state == 'CA'</code> and <code>LIMIT 5</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  LIMIT 5
  FILTER a.state == 'CA'
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, let&#8217;s see what happens step by step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">_key</th>
<th class="tableblock halign-left valign-top">_id</th>
<th class="tableblock halign-left valign-top">_rev</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">city</th>
<th class="tableblock halign-left valign-top">state</th>
<th class="tableblock halign-left valign-top">country</th>
<th class="tableblock halign-left valign-top">lat</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">vip</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/AMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxW-Aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amarillo International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amarillo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.2193725</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-101.7059272</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ATL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxa-_E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">William B Hartsfield-Atlanta Intl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atlanta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.64044444</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-84.42694444</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/DFW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxu&#8212;&#8203;I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dallas-Fort Worth International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dallas-Fort Worth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32.89595056</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-97.0372</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JFK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/JFK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyK-Aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John F Kennedy Intl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New York</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40.63975111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-73.77892556</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyS-_c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.94253611</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-118.4080744</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyq-AS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chicago O&#8217;Hare International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chicago</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">41.979595</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-87.90446417</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKz&#8212;&#8203;A-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">San Francisco International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">San Francisco</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">37.61900194</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-122.3748433</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the second step, we limit the output to maximum 5 records:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  LIMIT 5
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">_key</th>
<th class="tableblock halign-left valign-top">_id</th>
<th class="tableblock halign-left valign-top">_rev</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">city</th>
<th class="tableblock halign-left valign-top">state</th>
<th class="tableblock halign-left valign-top">country</th>
<th class="tableblock halign-left valign-top">lat</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">vip</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/AMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxW-Aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amarillo International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amarillo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35.2193725</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-101.7059272</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ATL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxa-_E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">William B Hartsfield-Atlanta Intl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Atlanta</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.64044444</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-84.42694444</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DFW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/DFW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKxu&#8212;&#8203;I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dallas-Fort Worth International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dallas-Fort Worth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32.89595056</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-97.0372</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JFK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/JFK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyK-Aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">John F Kennedy Intl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New York</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40.63975111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-73.77892556</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyS-_c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.94253611</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-118.4080744</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If we look closely, we now have lost SFO airport&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>In our final step, we pick those airports that are in California:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.vip == true
  LIMIT 5
  FILTER a.state == 'CA'
  RETURN a</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">_key</th>
<th class="tableblock halign-left valign-top">_id</th>
<th class="tableblock halign-left valign-top">_rev</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">city</th>
<th class="tableblock halign-left valign-top">state</th>
<th class="tableblock halign-left valign-top">country</th>
<th class="tableblock halign-left valign-top">lat</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">vip</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/LAX</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">_ZbpOKyS-_c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles International</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Los Angeles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">33.94253611</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-118.4080744</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Because we already lost SFO along the way we can&#8217;t show that anymore, meaning that our output is not correct.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_let_defining_variables">6.5.8. LET: defining variables</h4>
<div class="paragraph">
<p>In some cases it becomes complex or even impossible to put the whole query in a single nested combination of <code>FOR</code> loops, <code>FILTER`s and `SORT`s. Sometimes it&#8217;s easier to extract some data separately. That&#8217;s where `LET</code> comes in.</p>
</div>
<div class="paragraph">
<p>The following two queries give the same result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
RETURN a</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">LET myAirports = (
  FOR a IN airports
  RETURN a
)

FOR m IN myAirports
RETURN m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example where a <code>LET</code> is necessary. If we want to find out which airports to get to in 2 stops starting from Adak (ADK), we could first find out which airports can be reached <em>directly</em> from ADK, write those down, and then for each of these do a separate query to find the second airport. Or we can put the airports reached directly in an array that we loop over afterwards:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">LET arrivals1 = (
    FOR f IN flights
    FILTER f._from == 'airports/ADK'
    RETURN f._to)

FOR a IN arrivals1
    FOR f IN flights
    FILTER f._from == a
    RETURN DISTINCT f._to</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[ "airports/SEA", "airports/PDX", "airports/SLC", "airports/PHX",
  "airports/FAI", "airports/ADQ", "airports/JNU", "airports/MSP",
  "airports/OME", "airports/BET", "airports/SCC", "airports/HNL",
  "airports/CDV", "airports/LAS", "airports/OTZ", "airports/ORD",
  "airports/IAH", "airports/ADK" ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the last element in the list is ADK itself because obviously you can reach it again in 2 stops.</p>
</div>
</div>
<div class="sect3">
<h4 id="_functions_in_arangodb">6.5.9. Functions in ArangoDB</h4>
<div class="paragraph">
<p>ArangoDB includes a large collections of functions that can be run at different levels, e.g. to analyse the underlying database, to calculate aggregates like minimum and maximum from an array, to calculating the geographical distance between two locations on a map, to concatenate strings, etc. For a full list of functions see <a href="https://www.arangodb.com/docs/stable/aql/functions.html" class="bare">https://www.arangodb.com/docs/stable/aql/functions.html</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at some of these.</p>
</div>
<div class="sect4">
<h5 id="_concat_and_concat_separator"><code>CONCAT</code> and <code>CONCAT_SEPARATOR</code></h5>
<div class="paragraph">
<p>Using <code>CONCAT</code> and <code>CONCAT_SEPARATOR</code> we can return whole strings instead of just arrays and documents.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
  LIMIT 10
  RETURN [f.FlightNum, f._from, f._to]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
  LIMIT 10
  RETURN CONCAT("Flight ", f.FlightNum, " departs from ", f._from, " and goes to ", f._to, ".")</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[
"Flight 579 departs from airports/ATL and goes to airports/CHS.",
"Flight 2895 departs from airports/CLE and goes to airports/SAT.",
"Flight 7185 departs from airports/IAD and goes to airports/CLE.",
"Flight 859 departs from airports/JFK and goes to airports/PBI.",
"Flight 5169 departs from airports/CVG and goes to airports/MHT.",
"Flight 9 departs from airports/JFK and goes to airports/SFO.",
"Flight 1831 departs from airports/MIA and goes to airports/TPA.",
"Flight 5448 departs from airports/CVG and goes to airports/GSO.",
"Flight 878 departs from airports/FLL and goes to airports/JFK.",
"Flight 680 departs from airports/TPA and goes to airports/PBI."
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Something similar can be done with providing a separator. This can be useful when you&#8217;re creating a comma-separated file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
  LIMIT 10
  RETURN CONCAT_SEPARATOR(' -&gt; ', f._from, f._to)</code></pre>
</div>
</div>
<div class="paragraph">
<p>returns</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[
"airports/ATL -&gt; airports/CHS",
"airports/CLE -&gt; airports/SAT",
"airports/IAD -&gt; airports/CLE",
"airports/JFK -&gt; airports/PBI",
"airports/CVG -&gt; airports/MHT",
"airports/JFK -&gt; airports/SFO",
"airports/MIA -&gt; airports/TPA",
"airports/CVG -&gt; airports/GSO",
"airports/FLL -&gt; airports/JFK",
"airports/TPA -&gt; airports/PBI"
]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_min_and_max"><code>MIN</code> and <code>MAX</code></h5>
<div class="paragraph">
<p>These functions do what you expect them to do. See later in this post when we&#8217;re looking at [aggregation](#aggregation).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">RETURN MAX([1,5,20,1,4])</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_subqueries_2">6.5.10. Subqueries</h4>
<div class="paragraph">
<p>Remember that in SQL, we can replace the table mentioned in the <code>FROM</code> clause with a whole SQL statement, something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT COUNT(*) FROM (
  SELECT name FROM airports
  WHERE state = 'TX');</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can do something similar with AQL. For argument&#8217;s sake, let&#8217;s wrap a simple query into another one which just returns the result of the inner query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR s IN (
    FOR a IN airports
    LIMIT 2
    RETURN a
)
RETURN s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is exactly the same as if we would have run only the inner query. An AQL query similar to the SQL query above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR airport IN (
    FOR a IN airports
        FILTER a.state == "TX"
        RETURN a
    )
    COLLECT WITH COUNT INTO c
    RETURN c</code></pre>
</div>
</div>
<div class="paragraph">
<p>Don&#8217;t worry about the <code>COLLECT WITH COUNT INTO</code> yet. We&#8217;ll come back to that below&#8230;&#8203;</p>
</div>
</div>
<div class="sect3">
<h4 id="_joining_collections">6.5.11. Joining collections</h4>
<div class="sect4">
<h5 id="_inner_joins">Inner joins</h5>
<div class="paragraph">
<p>Just like inner joins in RDBMS, it is simple to combine different collections. In AQL we do this by nesting <code>FOR</code> loops. But like in RDBMS joins we have to make sure that there exists a <code>FILTER</code> in the inner loop to match up IDs. For example, to list all destination airports and distances for flights where the departure airport lies in California:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  FOR f IN flights
    FILTER f._from == a._id
    RETURN DISTINCT {departure: a._id, arrival: f._to, distance: f.Distance}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">airports/ACV  airports/SFO  250
airports/ACV  airports/SMF  207
airports/ACV  airports/CEC  56
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Remember from above that using links in a document setting might consitute a code smell. If you&#8217;re doing this a lot, check if your data should be modelled as a graph. Further down when we&#8217;re talking about ArangoDB as a graph database we&#8217;ll write a version of this same query that uses a graph approach.)</p>
</div>
<div class="paragraph">
<p>What if we want to show the departure and arrival airports full names instead of their codes, and have an additional filter on the arrival airport? To do this, we need an additional join with the airports table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a1 IN airports
  FILTER a1.state == 'CA'
  FOR f IN flights
    FILTER f._from == a1._id
    FOR a2 in airports
      FILTER a2._id == f._to
      FILTER a2.state == 'CA'
      RETURN DISTINCT {
        departure: a1.name,
        arrival: a2.name,
        distance: f.Distance }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return something like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Arcata  San Francisco International  250
Arcata  Sacramento International     207
Arcata  Jack McNamara                 56
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_outer_joins">Outer joins</h5>
<div class="paragraph">
<p>The above joins are inner joins, which means that we will only find the departure airports for which such arrival airports exist (see the SQL session). What if we want to list the airports in California that do not have any flights to other airports in California as well? In this case, put the second <code>FOR</code> loop within the <code>RETURN</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a1 IN airports
  FILTER a1.state == 'CA'
  RETURN {
    departure: a1.name,
    arrival: (
        FOR f IN flights
            FILTER f._from == a1._id
            FOR a2 in airports
                FILTER a2._id == f._to
                FILTER a2.state == 'CA'
                RETURN DISTINCT a2.name
                )}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">...
Buchanan         []
Jack McNamara    ["San Francisco International","Arcata"]
Chico Municipal  ["San Francisco International"]
Camarillo        []
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll see that e.g. Buchanan and Camarillo are also listed, which was not the case before.</p>
</div>
</div>
<div class="sect4">
<h5 id="_note_on_profiling">Note on profiling</h5>
<div class="paragraph">
<p>There are often many ways of getting to the correct results. However, some might be more efficient than others. Consider the example above where we list all destination airports and distances for flights where the departure airport lies in California. This will give 437 results:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">departure</th>
<th class="tableblock halign-left valign-top">arrival</th>
<th class="tableblock halign-left valign-top">distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/SFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/SMF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">207</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/ACV</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">airports/CEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">56</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  FOR f IN flights
    FILTER f._from == a._id
    RETURN DISTINCT {departure: a._id, arrival: f._to, distance: f.Distance}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also have started with the flights, and for each flight check if the departure airport (<code>f._from</code>) lies in California.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
    LET dep_airport = (
        FOR a IN airports
            FILTER a._id == f._from
            RETURN a.state
    )
    FILTER dep_airport[0] == 'CA'
    RETURN DISTINCT {departure: f._from, arrival: f._to, distance: f.Distance}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will give the same output, but run for a much longer time. The first version took 0.2 seconds; this second one 2.8 seconds. It is clear to see why: we apply a filter as soon as possible in the first version. A profile for this first version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Execution plan:
 Id   NodeType                  Calls   Items   Runtime [s]   Comment
  1   SingletonNode                 1       1       0.00000   * ROOT
  2   EnumerateCollectionNode       4    3363       0.00305     - FOR a IN airports   /* full collection scan, projections: `_id`, `state` */
  3   CalculationNode               4    3363       0.00058       - LET #2 = (a.`state` == "CA")   /* simple expression */   /* collections used: a : airports */
  4   FilterNode                    1     205       0.00052       - FILTER #2
 11   IndexNode                    35   34202       0.16585       - FOR f IN flights   /* edge index scan, projections: `Distance`, `_to` */
  8   CalculationNode              35   34202       0.05951         - LET #6 = { "departure" : a.`_id`, "arrival" : f.`_to`, "distance" : f.`Distance` }   /* simple expression */   /* collections used: a : airports, f : flights */
  9   CollectNode                   1     437       0.04776         - COLLECT #8 = #6   /* distinct */
 10   ReturnNode                    1     437       0.00000         - RETURN #8</code></pre>
</div>
</div>
<div class="paragraph">
<p>Profile for the second version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Execution plan:
 Id   NodeType                   Calls    Items   Runtime [s]   Comment
  1   SingletonNode                  1        1       0.00000   * ROOT
  2   EnumerateCollectionNode      287   286463       0.14689     - FOR f IN flights   /* full collection scan */
  9   SubqueryNode                 287   286463       5.97333       - LET dep_airport = ...   /* const subquery */
  3   SingletonNode             286463   286463       0.35125         * ROOT
 16   IndexNode                 286463   286283       2.66140           - FOR a IN airports   /* primary index scan, projections: `state` */
 15   LimitNode                 286463   286283       0.72835             - LIMIT 0, 1
  7   CalculationNode           286463   286283       0.74753             - LET #7 = a.`state`   /* attribute expression */   /* collections used: a : airports */
  8   ReturnNode                286463   286283       0.71181             - RETURN #7
 10   CalculationNode              287   286463       0.17962       - LET #9 = (dep_airport[0] == "CA")   /* simple expression */
 11   FilterNode                    35    34202       0.10274       - FILTER #9
 12   CalculationNode               35    34202       0.05116       - LET #11 = { "departure" : f.`_from`, "arrival" : f.`_to`, "distance" : f.`Distance` }   /* simple expression */   /* collections used: f : flights */
 13   CollectNode                    1      437       0.04276       - COLLECT #13 = #11   /* distinct */
 14   ReturnNode                     1      437       0.00000       - RETURN #13</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Calls</code> column shows how many times a particular line in the query is executed. In the first version, we check if the airport is in CA 3,363 times (as there are 3,363 airports). In the second version, we see that many of the steps in the query are performed 286,463 times (i.e. the number of records in the <code>flights</code> collection).</p>
</div>
<div class="paragraph">
<p>Take home message: think about the order in which you want to do things in a query. If possible, perform `FILTER`s and `LIMIT`s as early as possible.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_grouping">6.5.12. Grouping</h4>
<div class="paragraph">
<p>SQL has the <code>GROUP BY</code> pragma, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT name, COUNT(*) AS c
FROM airports
GROUP BY name;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To group results, AQL provides the <code>COLLECT</code> keyword.</p>
</div>
<div class="sect4">
<h5 id="_collect_on_its_own">COLLECT on its own</h5>
<div class="paragraph">
<p>The simplest way to use <code>COLLECT</code> is for getting distinct values back. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
COLLECT s = a.state
RETURN s</code></pre>
</div>
</div>
<div class="paragraph">
<p>What happens here? The <code>COLLECT s = a.state</code> takes the <code>state</code> key for each airport, and adds it to the new set called <code>s</code>. This set will then contain all unique values. This is actually exactly the same as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
RETURN DISTINCT a.state</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_collect_with_into">COLLECT with INTO</h5>
<div class="paragraph">
<p>What if you want to keep track of the records that actually make up the group itself?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
COLLECT s = a.state INTO airportsByState
RETURN { state: s, airports: airportsByState }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code goes through each airport, and <em>collects</em> the state that it&#8217;s in. It&#8217;ll return a list of states with for each the list of their airports:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">[
  {
    "state": "AK",
    "airports": [
      {
        "a": {
          "_key": "0AK", "_id": "airports/0AK", "_rev": "_ZYukZZy--e",
          "name": "Pilot Station", "city": "Pilot Station", "state": "AK", "country": "USA",
          "lat": 61.93396417, "long": "Pilot Station",
          "vip": false
        }
      },
      {
        "a": {
          "_key": "15Z", "_id": "airports/15Z", "_rev": "_ZYukZa---I",
          "name": "McCarthy 2", "city": "McCarthy", "state": "AK", "country": "USA",
          "lat": 61.43706083, "long": "McCarthy 2",
          "vip": false
        }
      },
      ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>a</code> in the output above refers to the <code>FOR a IN airports</code>. Using <code>FOR x IN airports</code> would have used <code>x</code> for each of the subdocuments above.</p>
</div>
<div class="paragraph">
<p>This output is however not ideal&#8230;&#8203; We basically just want to have the airport codes instead of the complete document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  COLLECT s = a.state INTO airportsByState
  RETURN {
    "state" : s,
    "airports" : airportsByState[*].a._id
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">state  airports
AK     ["airports/0AK","airports/15Z","airports/16A","airports/17Z", ...]
AL     ["airports/02A","airports/06A","airports/08A","airports/09A", ...]
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is this <code>[*].a._id</code>? If we look at the output from the previous query, we get the full document for each airport, and the form of the output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">[
  {
    "state": "AK",
    "airports": [ { "a": {..., "_id": "airports/0AK", ...} },
                  { "a": {...,"_id": "airports/15Z", ...} },
                  ...]
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>[<strong>].a._id</code> means "for each of these (<code></strong></code>), return the value for `a._id`". This is very helpful if you want to extract a certain key from an array of documents.</p>
</div>
</div>
<div class="sect4">
<h5 id="_collect_with_with_count_into">COLLECT with WITH COUNT INTO</h5>
<div class="paragraph">
<p><code>COLLECT</code> can be combined with the <code>WITH COUNT INTO</code> pragma to return the number of items instead of the items themselves, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  COLLECT state = a.state WITH COUNT INTO nrAirports
  SORT nrAirports DESC
  RETURN {
    "state" : state,
    "nrAirports" : nrAirports
  }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">AK  263
TX  209
CA  205
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above corresponds to the following in SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">SELECT state, count(*)
FROM airports
GROUP BY state;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example: how many flights does each carrier have?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
    COLLECT carrier = f.UniqueCarrier WITH COUNT INTO c
    SORT c DESC
    LIMIT 3
    RETURN {
        carrier: carrier,
        nrFlights: c
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The answer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">carrier  nrFlights
WN       48065
AA       24797
OO       22509</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apparently SouthWest Airlines (<code>WN</code>) has many more domestic flights than any other airline, including American Airlines (<code>AA</code>) and SkyWest Airlines (<code>OO</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_collect_with_aggregate">COLLECT with AGGREGATE</h5>
<div class="paragraph">
<p>We can go further and make calculations on these groupings as well. When using <code>AGGREGATE</code> we create a new variable and assign it a value using one of the functions that we saw earlier.</p>
</div>
<div class="paragraph">
<p>What is the average flight distance?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
    COLLECT AGGREGATE avg_length = AVG(f.Distance)
    RETURN avg_length</code></pre>
</div>
</div>
<div class="paragraph">
<p>The answer is 729.93 kilometers.</p>
</div>
<div class="paragraph">
<p>What is the shortest flight for each day of the week?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
  COLLECT dayOfWeek = f.DayOfWeek AGGREGATE minDistance = MIN(f.Distance)
  RETURN {
    "dow" : dayOfWeek,
    "minDistance": minDistance
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on this query, we see that Wednesday has the shortest flight.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">dow  minDistance
1    31
2    30
3    24
4    31
5    31
6    31
7    30</code></pre>
</div>
</div>
<div class="paragraph">
<p>OK, now we&#8217;re obviously interested in what those shortest flights are. Given what we have seen above, this will give us a map with those flights. For a geographical query, ArangoDB uses OpenStreetMap to visualise the returned points:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
  SORT f.Distance
  LIMIT 3
  LET myAirports = [DOCUMENT(f._from), DOCUMENT(f._to)]
  FOR a IN myAirports
    RETURN GEO_POINT(a.long, a.lat)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we used the <code>LET</code> operation for creating an array with two documents that we can loop over in the next lines using <code>FOR</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb-shortflights.png" alt="arangodb shortflights"></span></p>
</div>
<div class="paragraph">
<p>Intermezzo: now we&#8217;re curious: what actually are the names of the airports with the shortest flight? (They should be included in the picture above, right?)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
    SORT f.Distance
    LIMIT 1
    LET from = (
        FOR a IN airports
        FILTER a._id == f._from
        RETURN a.name )
    LET to = (
        FOR a IN airports
        FILTER a._id == f._to
        RETURN a.name )
    RETURN [from[0], to[0], f.Distance]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-javascript hljs" data-lang="javascript">[
  [
    "Washington Dulles International",
    "Ronald Reagan Washington National",
    24
  ]
]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_querying_graph_data">6.6. Querying graph data</h3>
<div class="paragraph">
<p>Although both <code>airports</code> and <code>flights</code> are collections in ArangoDB, we set <code>flights</code> to be an "Edge" collection, which means that it should have a <code>_from</code> and a <code>_to</code> key as it is used to link documents in other collections to each other.</p>
</div>
<div class="paragraph">
<p>There are 2 types of graphs in ArangoDB: named graphs and anonymous graphs.</p>
</div>
<div class="paragraph">
<p>Before we run the queries below, we will first create a named graph. To do so, click on <code>Graphs</code> and then on <code>Add Graph</code>. You will be presented with the following box:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_creategraph.png" alt="arangodb creategraph"></span></p>
</div>
<div class="paragraph">
<p>Here, select the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: flightsGraph</p>
</li>
<li>
<p>Edge definitions: flights</p>
</li>
<li>
<p>fromCollections: airports</p>
</li>
<li>
<p>toCollections: airports</p>
</li>
<li>
<p>Leave Vertex collections empty.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_graph_queries">6.6.1. Graph queries</h4>
<div class="paragraph">
<p>Of course what are we with graphs if we can&#8217;t ask graph-specific questions. At the beginning of this post, we looked at how difficult it was to identify all friends of friends of James. What would this look like in a graph database?</p>
</div>
<div class="paragraph">
<p>The <code>FOR</code> syntax looks a little different when you&#8217;re querying a graph rather than a collection of documents. It&#8217;s</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR v,e,p IN 2..2 ANY "myKey" GRAPH "myGraph"
LIMIT 5
RETURN v._id</code></pre>
</div>
</div>
<div class="paragraph">
<p>This means (going from right to left):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>take the graph <code>myGraph</code></p>
</li>
<li>
<p>start from the document with <code>_key</code> of <code>myKey</code></p>
</li>
<li>
<p>follow links in both directions (<code>ANY</code> is both <code>INBOUND</code> and <code>OUTBOUND</code>)</p>
</li>
<li>
<p>for 2 steps (<code>2..2</code> means <code>min..max</code>)</p>
</li>
<li>
<p>take the final vertex <code>v</code>, the last link that lead to it <code>e</code>, and the whole path <code>p</code> from start to finish</p>
</li>
<li>
<p>and return the final vertex&#8217;s id</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The whole path <code>p</code> contains the full list of vertices from source to target, as well as the list of edges between them.</p>
</div>
<div class="paragraph">
<p>Note that the key  graph need to be in quotes. The result of the query</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR v,e,p IN 2..2 ANY "airports/JFK" GRAPH "flights"
LIMIT 5
RETURN v._id</code></pre>
</div>
</div>
<div class="paragraph">
<p>is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[
  "airports/IAH",
  "airports/JFK",
  "airports/CLT",
  "airports/EWR",
  "airports/ATL"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This query is lightning fast compared to what we did with the friends of a friend using a relational database!!</p>
</div>
<div class="paragraph">
<p>Of course you can add additional filters as well, for example to only return those that are located in California:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR v,e,p IN 2..2 ANY 'airports/JFK' GRAPH 'flightsGraph'
LIMIT 5000
FILTER v.state == 'CA'
RETURN DISTINCT v._id</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>LIMIT 5000</code> is so that we don&#8217;t go through the whole dataset here, as we&#8217;re just running this for demonstration purposes. The result of this query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[
  "airports/SAN",
  "airports/LAX",
  "airports/ONT",
  "airports/BFL",
  "airports/SNA",
  "airports/SMF",
  "airports/FAT",
  "airports/SBP",
  "airports/PSP",
  "airports/SBA",
  "airports/PMD",
  "airports/MRY",
  "airports/ACV",
  "airports/BUR",
  "airports/CIC",
  "airports/CEC",
  "airports/MOD",
  "airports/RDD"
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You actually don&#8217;t need to create the graph beforehand, and can use the edge collections directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR v,e,p IN 2..2 ANY 'airports/JFK' flights
LIMIT 5000
FILTER v.state == 'CA'
RETURN DISTINCT v._id</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we don&#8217;t use the keyword <code>GRAPH</code>,  collection is not in quotes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rewriting_the_document_query_that_used_joins">6.6.2. Rewriting the document query that used joins</h4>
<div class="paragraph">
<p>Above we said that we&#8217;d rewrite a query that used the document approach to one that uses a graph approach. The original query listed all airports in California, and listed where any flights were going to and what the distance is.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  FOR f IN flights
    FILTER f._from == a._id
    RETURN DISTINCT {departure: a._id, arrival: f._to, distance: f.Distance}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can approach this from a graph perspective as well. Instead of checking the <code>_from</code> key in the <code>flights</code> documents, we consider the flights as a graph: we take all Californian airports, and follow all outbound links with a distance of 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  FOR v,e,p IN 1..1 OUTBOUND a flights
    RETURN DISTINCT { departure: a._id, arrival: v._id, distance: e.Distance}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives the same results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">airports/ACV  airports/SFO  250
airports/ACV  airports/SMF  207
airports/ACV  airports/CEC  56
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that we actually had quite a bit of work if we wanted to show the airport <em>names</em> instead of their codes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a1 IN airports
  FILTER a1.state == 'CA'
  FOR f IN flights
    FILTER f._from == a1._id
    FOR a2 in airports
      FILTER a2._id == f._to
      FILTER a2.state == 'CA'
      RETURN DISTINCT {
        departure: a1.name,
        arrival: a2.name,
        distance: f.Distance }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In constrast, we only need to make a minor change in the <code>RETURN</code> statement of the graph query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR a IN airports
  FILTER a.state == 'CA'
  FOR v,e,p IN 1..1 OUTBOUND a flights
    RETURN DISTINCT { departure: a.name, arrival: v.name, distance: e.Distance}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shortest_path">6.6.3. Shortest path</h4>
<div class="paragraph">
<p>The <code>SHORTEST_PATH</code> function (see [here](<a href="https://www.arangodb.com/docs/stable/aql/graphs-kshortest-paths.html)" class="bare">https://www.arangodb.com/docs/stable/aql/graphs-kshortest-paths.html)</a>) allows you to find the shortest path between two nodes. For example: how to get in the smallest number of steps from the airport of Pellston Regional of Emmet County (PLN) to Adak (ADK)?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR path IN OUTBOUND SHORTEST_PATH 'airports/PLN' TO 'airports/ADK' flights
RETURN path</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">_key  _id           _rev         name                                 city       state  country  lat          long          vip
PLN   airports/PLN  _ZbpOKyy--Q  Pellston Regional of Emmet County    Pellston   MI     USA      45.5709275   -84.796715    false
DTW   airports/DTW  _ZbpOKxu-_S  Detroit Metropolitan-Wayne County    Detroit    MI     USA      42.21205889  -83.34883583  false
IAH   airports/IAH  _ZbpOKyK---  George Bush Intercontinental         Houston    TX     USA      29.98047222  -95.33972222  false
ANC   airports/ANC  _ZbpOKxW-Am  Ted Stevens Anchorage International  Anchorage  AK     USA      61.17432028  -149.9961856  false
ADK   airports/ADK  _ZbpOKxW--o  Adak                                 Adak       AK     USA      51.87796389  -176.6460306  false</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above does not take into account the distance that is flown. We can add that as the weight:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR path IN OUTBOUND SHORTEST_PATH 'airports/PLN' TO 'airports/ADK' flights
OPTIONS {
  weightAttribute: "Distance"
}
RETURN path</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows that flying of Minneapolis instead of Houston would cut down on the number of miles flown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">_key  _id           _rev         name                                 city         state  country  lat          long          vip
PLN   airports/PLN  _ZbpOKyy--Q  Pellston Regional of Emmet County    Pellston     MI     USA      45.5709275   -84.796715    false
DTW   airports/DTW  _ZbpOKxu-_S  Detroit Metropolitan-Wayne County    Detroit      MI     USA      42.21205889  -83.34883583  false
MSP   airports/MSP  _ZbpOKyi--9  Minneapolis-St Paul Intl             Minneapolis  MN     USA      44.88054694  -93.2169225   false
ANC   airports/ANC  _ZbpOKxW-Am  Ted Stevens Anchorage International  Anchorage    AK     USA      61.17432028  -149.9961856  false
ADK   airports/ADK  _ZbpOKxW--o  Adak                                 Adak         AK     USA      51.87796389  -176.6460306  false</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pattern_matching">6.6.4. Pattern matching</h4>
<div class="paragraph">
<p>What if we want to find a complex pattern in a graph, such as loops, triangles, alternative paths, etc (see [above](#subgraph-mapping))? Let&#8217;s say we want to find any alternative paths of length 3: where there are flights from airport 1 to airport 2 and from airport 2 to airport 4, but also from airport 1 to airport 3 and from airport 3 to airport 4.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/saves.png" alt="saves"></span></p>
</div>
<div class="paragraph">
<p>Let&#8217;s check if there are alternative paths of length 2 between JFK and San Francisco SFO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR v,e,p IN 2..2 ANY "airports/JFK" flights
FILTER v._id == 'airports/SFO'
LIMIT 5000
RETURN DISTINCT p.vertices[1]._id</code></pre>
</div>
</div>
<div class="paragraph">
<p>It seems that there are many, including Atlanta (ATL), Boston (BOS), Phoenix (PHX), etc.</p>
</div>
<div class="paragraph">
<p>For an in-depth explanation on pattern matching, see <a href="https://www.arangodb.com/arangodb-training-center/graphs/pattern-matching/" class="bare">https://www.arangodb.com/arangodb-training-center/graphs/pattern-matching/</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_centrality">6.6.5. Centrality</h4>
<div class="paragraph">
<p>As mentioned above, not all ArangoDB functonality is available through the web interface. For centrality queries and community detection, we&#8217;ll have to refer you to the <a href="https://www.arangodb.com/docs/stable/programs-arangosh.html">arangosh documentation</a> and <a href="https://www.arangodb.com/pregel-community-detection/">community detection tutorial</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_improving_performance">6.7. Improving performance</h3>
<div class="paragraph">
<p>As with any other database system, the actual setup of your database and how you write your query can have a huge impact on how fast the query runs.</p>
</div>
<div class="sect3">
<h4 id="_indices_2">6.7.1. Indices</h4>
<div class="paragraph">
<p>Consider the following query which returns all flights of the plane with tail number "N937AT".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR f IN flights
FILTER f.TailNum == 'N937AT'
RETURN f</code></pre>
</div>
</div>
<div class="paragraph">
<p>This takes more than 3 seconds to run. If we <em>explain</em> this query (click the "Explain" button instead of "Execute"), we see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Query String:
 FOR f IN flights
 FILTER f.TailNum == 'N937AT'
 RETURN f

Execution plan:
 Id   NodeType                    Est.   Comment
  1   SingletonNode                  1   * ROOT
  2   EnumerateCollectionNode   286463     - FOR f IN flights   /* full collection scan */
  3   CalculationNode           286463       - LET #1 = (f.`TailNum` == "N937AT")   /* simple expression */   /* collections used: f : flights */
  4   FilterNode                286463       - FILTER #1
  5   ReturnNode                286463       - RETURN f

Indexes used:
 none

Optimization rules applied:
 none</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that the query loops over all 286463 documents and checks for each if its <code>TailNum</code> is equal to <code>N937AT</code>. This is very expensive, as a <em>profile</em> (Click the "Profile" button) also shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Query String:
 FOR f IN flights
 FILTER f.TailNum == 'N937AT'
 RETURN f

Execution plan:
 Id   NodeType                  Calls    Items   Runtime [s]   Comment
  1   SingletonNode                 1        1       0.00000   * ROOT
  2   EnumerateCollectionNode     287   286463       1.03926     - FOR f IN flights   /* full collection scan */
  3   CalculationNode             287   286463       0.10772       - LET #1 = (f.`TailNum` == "N937AT")   /* simple expression */   /* collections used: f : flights */
  4   FilterNode                    1       86       0.17727       - FILTER #1
  5   ReturnNode                    1       86       0.00000       - RETURN f

Indexes used:
 none

Optimization rules applied:
 none

Query Statistics:
 Writes Exec   Writes Ign   Scan Full   Scan Index   Filtered   Exec Time [s]
           0            0      286463            0     286377         1.32650

Query Profile:
 Query Stage           Duration [s]
 initializing               0.00000
 parsing                    0.00012
 optimizing ast             0.00000
 loading collections        0.00001
 instantiating plan         0.00007
 optimizing plan            0.00106
 executing                  1.32438
 finalizing                 0.00050</code></pre>
</div>
</div>
<div class="paragraph">
<p>What we should do here, is create an index on <code>TailNum</code>. This will allow the system to pick those documents that match a certain tail number from a hash rather than having to check every single document. To create an index, go to <code>Collections</code>, and click on the <code>flights</code> collection. At the top you&#8217;ll see <code>Indexes</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_indices_1.png" alt="arangodb indices 1"></span></p>
</div>
<div class="paragraph">
<p>We&#8217;ll want to create a persistent index with the following settings (i.e. tail number is not unique across all flights, and is not sparse (in other words: tail number is almost always provided)):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_indices_2.png" alt="arangodb indices 2" width="50%"></span></p>
</div>
<div class="paragraph">
<p>After creating the index, an <em>explain</em> shows that we are not doing a full collection scan anymore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Query String:
 FOR f IN flights
 FILTER f.TailNum == 'N937AT'
 RETURN f

Execution plan:
 Id   NodeType        Est.   Comment
  1   SingletonNode      1   * ROOT
  6   IndexNode         60     - FOR f IN flights   /* persistent index scan */
  5   ReturnNode        60       - RETURN f

Indexes used:
 By   Name      Type         Collection   Unique   Sparse   Selectivity   Fields          Ranges
  6   TailNum   persistent   flights      false    false         1.66 %   [ `TailNum` ]   (f.`TailNum` == "N937AT")

Optimization rules applied:
 Id   RuleName
  1   use-indexes
  2   remove-filter-covered-by-index
  3   remove-unnecessary-calculations-2</code></pre>
</div>
</div>
<div class="paragraph">
<p>And indeed, running <em>profile</em> gives consistent results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Query String:
 FOR f IN flights
 FILTER f.TailNum == 'N937AT'
 RETURN f

Execution plan:
 Id   NodeType        Calls   Items   Runtime [s]   Comment
  1   SingletonNode       1       1       0.00000   * ROOT
  6   IndexNode           1      86       0.00282     - FOR f IN flights   /* persistent index scan */
  5   ReturnNode          1      86       0.00000       - RETURN f

Indexes used:
 By   Name      Type         Collection   Unique   Sparse   Selectivity   Fields          Ranges
  6   TailNum   persistent   flights      false    false         1.66 %   [ `TailNum` ]   (f.`TailNum` == "N937AT")

Optimization rules applied:
 Id   RuleName
  1   use-indexes
  2   remove-filter-covered-by-index
  3   remove-unnecessary-calculations-2

Query Statistics:
 Writes Exec   Writes Ign   Scan Full   Scan Index   Filtered   Exec Time [s]
           0            0           0           86          0         0.00327

Query Profile:
 Query Stage           Duration [s]
 initializing               0.00000
 parsing                    0.00009
 optimizing ast             0.00001
 loading collections        0.00001
 instantiating plan         0.00003
 optimizing plan            0.00016
 executing                  0.00287
 finalizing                 0.00009</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the index, our query is 406 times faster. Instead of going over all 286463 documents in the original version, now it only checks 86.</p>
</div>
</div>
<div class="sect3">
<h4 id="_avoid_going_over_supernodes">6.7.2. Avoid going over supernodes</h4>
<div class="paragraph">
<p>(Note: the following is largely based on the white paper "Switching from Relational Databases to ArangoDB" available at <a href="https://www.arangodb.com/arangodb-white-papers/white-paper-switching-relational-database/" class="bare">https://www.arangodb.com/arangodb-white-papers/white-paper-switching-relational-database/</a>)</p>
</div>
<div class="paragraph">
<p><em>Super nodes</em> are nodes in a graph with very high connectivity. Queries that touch those nodes will have to follow all those edges. Consider a database with songs information that is modelled like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_songs.png" alt="arangodb songs" width="50%"></span></p>
</div>
<div class="paragraph">
<p><em>Source: White paper mentioned above</em></p>
</div>
<div class="paragraph">
<p>There are 4 document collections (<code>Song</code>, <code>Artist</code>, <code>Album</code> and <code>Genre</code>), and 3 edge collections (<code>Made</code>, <code>PartOf</code> and <code>Has</code>).</p>
</div>
<div class="paragraph">
<p>Some of Aerosmith&#8217;s data might look like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/arangodb_aerosmith.png" alt="arangodb aerosmith" width="50%"></span></p>
</div>
<div class="paragraph">
<p><em>Source: White paper mentioned above</em></p>
</div>
<div class="paragraph">
<p>Suppose that we want to answer this question: "“I just listened to a song called, Tribute and I liked it very much. I suspect that there may be other songs of the same genre as this song that I might enjoy. So, I want to find all of the albums of the same genre that were released in the same year". Here&#8217;s a first stab at such query.</p>
</div>
<div class="paragraph">
<p>Version 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR s IN Song
  FILTER s.Title == "Tribute"
  // We want to find a Song called Tribute
    FOR album IN 1 INBOUND s PartOf
    // Now we have the Album this Song is released on
      FOR genre IN 1 OUTBOUND album Has
      // Now we have the genre of this Album
        FOR otherAlbum IN 1 INBOUND genre Has
        // All other Albums with this genre
          FILTER otherAlbum.year == album.year
          // Only keep those where the year is identical
            RETURN otherAlbum</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/supernode_1.png" alt="supernode 1"></span></p>
</div>
<div class="paragraph">
<p>All goes well until we hit <code>FOR otherAlbum IN 1 INBOUND genre Has</code>, because at that point it will follow all links to the albums of that genre. It&#8217;s therefore better to first select all albums of the same year, and <em>filter</em> for the genre. This way we&#8217;ll only get a limited number of albums, and each of them has only one genre.</p>
</div>
<div class="paragraph">
<p>Version 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-sql hljs" data-lang="sql">FOR s IN Song
  FILTER s.Title == "Tribute"
  // We want to find a Song called Tribute
    FOR album IN 1 INBOUND s PartOf
    // Now we have the Album this Song is released on
      FOR genre IN 1 OUTBOUND album Has
      // Get the genres of this Album
        FOR otherAlbum IN Album
        // Now we want all other Albums of the same year
          FILTER otherAlbum.Year == album.Year
          // So here we join album with album based on identical year
            FOR otherGenre IN 1 OUTBOUND otherAlbum Has
              FILTER otherGenre == genre
              // Validate that the genre of the other album is identical
              // to the genre of the original album
                RETURN otherAlbum
                // Finally return all albums of the same year
                // with the same genre</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image"><img src="assets/supernode_2.png" alt="supernode 2"></span></p>
</div>
<div class="paragraph">
<p>Again, a look at <em>explain</em> helps a lot here.</p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_graph_databases.html">Graph databases</a> | ↑ Up: <a href="index.html">Data Management</a> | Next: <a href="_arangodb_apis.html">ArangoDB APIs</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-11-24 09:35:28 +0100
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>
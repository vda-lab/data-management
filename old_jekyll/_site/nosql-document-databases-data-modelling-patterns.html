<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" nosql">
<title>Data modelling patterns | Data Management</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-custom.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="data-management" href="http://localhost:4000/feed.xml">

<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Data Management</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/vda-lab/data-management" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="rdbms_landing_page.html">Relational databases and SQL</a></li>
                        
                        
                        
                        <li><a href="nosql_landing_page.html">NoSQL</a></li>
                        
                        
                        
                        <li><a href="lambda_landing_page.html">Lambda architecture</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Data modelling patterns">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">NoSQL databases </li>
  
  
  
      
  
      
  
  <li>
      <a title="Issues with relational databases" href="#">Issues with relational databases</a>
      <ul>
          
          
          
          <li><a title="Scalability and clusters" href="nosql-scalability-and-clusters.html">Scalability and clusters</a></li>
          
          
          
          
          
          
          <li><a title="Impedance mismatch" href="nosql-impedance-mismatch.html">Impedance mismatch</a></li>
          
          
          
          
          
          
          <li><a title="Relational data" href="nosql-relational-data.html">Relational data</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="General NoSQL concepts" href="#">General NoSQL concepts</a>
      <ul>
          
          
          
          <li><a title="General NoSQL concepts" href="nosql-general-concepts.html">General NoSQL concepts</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Intermezzo - JSON" href="#">Intermezzo - JSON</a>
      <ul>
          
          
          
          <li><a title="Intermezzo - JSON" href="nosql-intermezzo-json.html">Intermezzo - JSON</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Key/value stores" href="#">Key/value stores</a>
      <ul>
          
          
          
          <li><a title="Key/value stores" href="nosql-keyvalue-stores.html">Key/value stores</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Document-oriented databases" href="#">Document-oriented databases</a>
      <ul>
          
          
          
          <li><a title="Introduction" href="nosql-document-databases-introduction.html">Introduction</a></li>
          
          
          
          
          
          
          <li><a title="Concepts" href="nosql-document-databases-concepts.html">Concepts</a></li>
          
          
          
          
          
          
          <li><a title="Data modelling" href="nosql-document-databases-data-modelling.html">Data modelling</a></li>
          
          
          
          
          
          
          <li class="active"><a title="Data modelling patterns" href="nosql-document-databases-data-modelling-patterns.html">Data modelling patterns</a></li>
          
          
          
          
          
          
          <li><a title="Difference with key/value stores" href="nosql-difference-with-keyvalue-stores.html">Difference with key/value stores</a></li>
          
          
          
          
          
          
          <li><a title="Implementations" href="nosql-document-databases-implementations.html">Implementations</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Graph databases" href="#">Graph databases</a>
      <ul>
          
          
          
          <li><a title="Introduction" href="nosql-graph-databases-introduction.html">Introduction</a></li>
          
          
          
          
          
          
          <li><a title="Nomenclature" href="nosql-graph-databases-nomenclature.html">Nomenclature</a></li>
          
          
          
          
          
          
          <li><a title="Centralities" href="nosql-graph-databases-centralities.html">Centralities</a></li>
          
          
          
          
          
          
          <li><a title="Graph mining" href="nosql-graph-databases-mining.html">Graph mining</a></li>
          
          
          
          
          
          
          <li><a title="Data modelling" href="nosql-graph-databases-data-modelling.html">Data modelling</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="ArangoDB" href="#">ArangoDB</a>
      <ul>
          
          
          
          <li><a title="A multi-model database" href="nosql-arangodb-multimodel-database.html">A multi-model database</a></li>
          
          
          
          
          
          
          <li><a title="Starting with ArangoDB" href="nosql-starting-with-arangodb.html">Starting with ArangoDB</a></li>
          
          
          
          
          
          
          <li><a title="Loading data" href="nosql-arangodb-loading-data.html">Loading data</a></li>
          
          
          
          
          
          
          <li><a title="Querying key/value data" href="nosql-arangodb-querying-keyvalue-data.html">Querying key/value data</a></li>
          
          
          
          
          
          
          <li><a title="Querying document data" href="nosql-arangodb-querying-document-data.html">Querying document data</a></li>
          
          
          
          
          
          
          <li><a title="Querying graph data" href="nosql-arangodb-querying-graph-data.html">Querying graph data</a></li>
          
          
          
          
          
          
          <li><a title="Improving performance" href="nosql-arangodb-improving-performance.html">Improving performance</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="ArangoDB APIs" href="#">ArangoDB APIs</a>
      <ul>
          
          
          
          <li><a title="APIs" href="nosql-arangodb-apis.html">APIs</a></li>
          
          
          
          
          
          
          <li><a title="ArangoDB and R" href="nosql-arangodb-and-r.html">ArangoDB and R</a></li>
          
          
          
          
          
          
          <li><a title="ArangoDB and python" href="nosql-arangodb-and-python.html">ArangoDB and python</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block: -->
         <!-- <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p> -->

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Data modelling patterns</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

   <!-- see https://www.youtube.com/watch?v=yuPjoC3jmPA -->
<!-- see https://www.youtube.com/watch?v=bxw1AkH2aM4&t=1496s -->
<!-- see https://www.mongodb.com/blog/post/building-with-patterns-a-summary -->

<div class="seriesContext">
  
  
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
  
  

  
    <a href="nosql-document-databases-data-modelling.html"><button type="button" class="btn btn-primary">Previous: Data modelling</button></a>
  
</div>

<p>According to Wikipedia, “a […] design pattern is a general, reusable solution to a commonly occurring problem”. This is also true for designing the data model (of data schema) in document databases. Below, we will go over some of these design patterns. A more complete list and explanation is available on e.g. the <a href="https://www.mongodb.com/blog/post/building-with-patterns-a-summary">MongoDB blog</a>. Many of the examples below also come from that source.</p>

<h2 id="attribute-pattern">Attribute pattern</h2>
<p>In the attribute pattern, we group similar fields (i.e. with the same value type) into a single array. Consider for example the following document on the movie “Star Wars”:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"Star Wars"</span><span class="p">,</span><span class="w">
  </span><span class="err">new_title:</span><span class="w"> </span><span class="s2">"Star Wars: Episode IV - A New Hope"</span><span class="p">,</span><span class="w">
  </span><span class="err">director:</span><span class="w"> </span><span class="s2">"George Lucas"</span><span class="p">,</span><span class="w">
  </span><span class="err">release_US:</span><span class="w"> </span><span class="s2">"1977-05-20"</span><span class="p">,</span><span class="w">
  </span><span class="err">release_France:</span><span class="w"> </span><span class="s2">"1977-10-19"</span><span class="p">,</span><span class="w">
  </span><span class="err">release_Italy:</span><span class="w"> </span><span class="s2">"1977-10-20"</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>To make quick searches on the release date we’d have to put an index on every single key that starts with <code class="language-plaintext highlighter-rouge">release_</code>. Another approach is to put these together in a separate attribute:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"Star Wars"</span><span class="p">,</span><span class="w">
  </span><span class="err">new_title:</span><span class="w"> </span><span class="s2">"Star Wars: Episode IV - A New Hope"</span><span class="p">,</span><span class="w">
  </span><span class="err">director:</span><span class="w"> </span><span class="s2">"George Lucas"</span><span class="p">,</span><span class="w">
  </span><span class="err">releases:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">country:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"1977-05-20"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">country:</span><span class="w"> </span><span class="s2">"France"</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"1977-10-19"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">country:</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"1977-10-20"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>In this case we only have to make a combined index on <code class="language-plaintext highlighter-rouge">releases.country</code> and <code class="language-plaintext highlighter-rouge">releases.date</code>.</p>

<h2 id="bucket-pattern">Bucket pattern</h2>
<p>Do you always want to store each datapoint in a separate document? You don’t have to. A good example is time-series data, e.g. from sensors. If those sensors return a value every second, you will end up with a <em>lot</em> of documents. Especially if you’re not necessarily interested in that resolution it makes sense to bucket the data.</p>

<p>For example, you <em>could</em> store data from a temperature sensor like this:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">sensor_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">datetime:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:58"</span><span class="p">,</span><span class="w">
  </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">sensor_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">datetime:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:59"</span><span class="p">,</span><span class="w">
  </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">sensor_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">datetime:</span><span class="w"> </span><span class="s2">"2020-10-12 10:11:00"</span><span class="p">,</span><span class="w">
  </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.4</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">sensor_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">datetime:</span><span class="w"> </span><span class="s2">"2020-10-12 10:11:01"</span><span class="p">,</span><span class="w">
  </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.4</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span></code></pre></figure>

<p>But obviously we’re not really interested in the per-second readings. A more proper time period could be e.g. each 5 minutes. Your document would - using the bucket pattern - then look like this:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">sensor_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">start:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:00"</span><span class="p">,</span><span class="w">
  </span><span class="err">end:</span><span class="w"> </span><span class="s2">"2020-10-12 10:15:00"</span><span class="p">,</span><span class="w">
  </span><span class="err">readings:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:01"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:02"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:03"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:14:59"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.4</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>This has several advantages:</p>
<ul>
  <li>it fits more with the time granularity that we are thinking in</li>
  <li>it will be easy to compute aggregations in this granularity</li>
  <li>if we see that we don’t need the high-resolution data after a while, we can safely delete the <code class="language-plaintext highlighter-rouge">readings</code> part if we need to (e.g. to safe on storage space)</li>
</ul>

<h2 id="computed-pattern">Computed pattern</h2>
<p>Using buckets is actually a great segue into the computed pattern.</p>

<p>It is not unusual that you end up extracting information from a database and immediately make simple or complex calculations. At that point you can make the decision to store the pre-computed values in the database as well. Technically you’re duplicating data (the original fields plus a derived field), but it might speed up your application a lot.</p>

<p>In the bucket pattern example above, we want to always look at the average temperature in those 5-minute intervals. We can calculate that every time we fetch the data from the database, but we can actually pre-calculate it as well and store that result in the document itself.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">sensor_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">start:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:00"</span><span class="p">,</span><span class="w">
  </span><span class="err">end:</span><span class="w"> </span><span class="s2">"2020-10-12 10:15:00"</span><span class="p">,</span><span class="w">
  </span><span class="err">readings:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:01"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:02"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:10:03"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">timestamp:</span><span class="w"> </span><span class="s2">"2020-10-12 10:14:59"</span><span class="p">,</span><span class="w"> </span><span class="err">value:</span><span class="w"> </span><span class="mf">27.4</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">]</span><span class="w">
  </span><span class="err">avg_reading:</span><span class="w"> </span><span class="mf">27.326</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<h2 id="extended-reference">Extended reference</h2>
<p>We use the extended reference when we need many joins to bring together frequently accessed data. For example, consider information on customers and orders. Because this is a many-to-many relationship, we would use a referencing approach, and store a particular customer and one of their orders like this (yet another example from the MongoDB website):</p>

<p>In the <code class="language-plaintext highlighter-rouge">customers</code> collection:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="s2">"cust_123"</span><span class="p">,</span><span class="w">
  </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Katrina Pope"</span><span class="p">,</span><span class="w">
  </span><span class="err">address:</span><span class="w"> </span><span class="s2">"123 Main Str"</span><span class="p">,</span><span class="w">
  </span><span class="err">city:</span><span class="w"> </span><span class="s2">"Somewhere"</span><span class="p">,</span><span class="w">
  </span><span class="err">country:</span><span class="w"> </span><span class="s2">"Someplace"</span><span class="p">,</span><span class="w">
  </span><span class="err">dateofbirth:</span><span class="w"> </span><span class="s2">"1992-11-03"</span><span class="p">,</span><span class="w">
  </span><span class="err">social_networks:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"@me123"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>In the <code class="language-plaintext highlighter-rouge">orders</code> collection:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="s2">"order_1827"</span><span class="p">,</span><span class="w">
  </span><span class="err">date:</span><span class="w"> </span><span class="s2">"2019-02-18"</span><span class="p">,</span><span class="w">
  </span><span class="err">customer_id:</span><span class="w"> </span><span class="s2">"cust_123"</span><span class="p">,</span><span class="w">
  </span><span class="err">order:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">product:</span><span class="w"> </span><span class="s2">"paper"</span><span class="p">,</span><span class="w"> </span><span class="err">qty:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">cost:</span><span class="w"> </span><span class="mf">3.49</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">product:</span><span class="w"> </span><span class="s2">"pen"</span><span class="p">,</span><span class="w"> </span><span class="err">qty:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="err">cost:</span><span class="w"> </span><span class="mf">0.99</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]}</span></code></pre></figure>

<p>Now to know where the order should be shipped, we always need to make a join with the <code class="language-plaintext highlighter-rouge">customers</code> table to get the address. Using the extended reference pattern, we copy the necessary information (but nothing more) into the order itself:</p>

<p>In the <code class="language-plaintext highlighter-rouge">customers</code> collection:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="s2">"cust_123"</span><span class="p">,</span><span class="w">
  </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Katrina Pope"</span><span class="p">,</span><span class="w">
  </span><span class="err">address:</span><span class="w"> </span><span class="s2">"123 Main Str"</span><span class="p">,</span><span class="w">
  </span><span class="err">city:</span><span class="w"> </span><span class="s2">"Somewhere"</span><span class="p">,</span><span class="w">
  </span><span class="err">country:</span><span class="w"> </span><span class="s2">"Someplace"</span><span class="p">,</span><span class="w">
  </span><span class="err">dateofbirth:</span><span class="w"> </span><span class="s2">"1992-11-03"</span><span class="p">,</span><span class="w">
  </span><span class="err">social_networks:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"@me123"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>In the <code class="language-plaintext highlighter-rouge">orders</code> collection, we now also have the <code class="language-plaintext highlighter-rouge">shipping_address</code> key which is a copy of information from the <code class="language-plaintext highlighter-rouge">customers</code> table:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">_id:</span><span class="w"> </span><span class="s2">"order_1827"</span><span class="p">,</span><span class="w">
  </span><span class="err">date:</span><span class="w"> </span><span class="s2">"2019-02-18"</span><span class="p">,</span><span class="w">
  </span><span class="err">customer_id:</span><span class="w"> </span><span class="s2">"cust_123"</span><span class="p">,</span><span class="w">
  </span><span class="err">shipping_address:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Katrina Pope"</span><span class="p">,</span><span class="w">
    </span><span class="err">address:</span><span class="w"> </span><span class="s2">"123 Main Str"</span><span class="p">,</span><span class="w">
    </span><span class="err">city:</span><span class="w"> </span><span class="s2">"Somewhere"</span><span class="p">,</span><span class="w">
    </span><span class="err">country:</span><span class="w"> </span><span class="s2">"Someplace"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="err">order:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">product:</span><span class="w"> </span><span class="s2">"paper"</span><span class="p">,</span><span class="w"> </span><span class="err">qty:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">cost:</span><span class="w"> </span><span class="mf">3.49</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="err">product:</span><span class="w"> </span><span class="s2">"pen"</span><span class="p">,</span><span class="w"> </span><span class="err">qty:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="err">cost:</span><span class="w"> </span><span class="mf">0.99</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]}</span></code></pre></figure>

<h2 id="polymorphic-pattern">Polymorphic pattern</h2>
<p>As we’ve seen before, we can create heterogeneous collections where different types of things or concepts are stored in the same collection. But even if each document is of the same type of thing, we might still need a different scheme for different documents. So this is true for documents that are similar but not identical. An example for athletes: each has a name, date of birth, etc, but only tennis players have the key <code class="language-plaintext highlighter-rouge">grand_slams_won</code>.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Serena Williams"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_of_birth:</span><span class="w"> </span><span class="s2">"1981-09-26"</span><span class="p">,</span><span class="w">
  </span><span class="err">country:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
  </span><span class="err">nr_grand_slams_won:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span><span class="w">
  </span><span class="err">highest_atp_ranking:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Kim Clijsters"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_of_birth:</span><span class="w"> </span><span class="s2">"1983-06-08"</span><span class="p">,</span><span class="w">
  </span><span class="err">country:</span><span class="w"> </span><span class="s2">"Belgium"</span><span class="p">,</span><span class="w">
  </span><span class="err">nr_grand_slams_won:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
  </span><span class="err">highest_atp_ranking:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Alberto Contador"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_of_birth:</span><span class="w"> </span><span class="s2">"1982-12-06"</span><span class="p">,</span><span class="w">
  </span><span class="err">country:</span><span class="w"> </span><span class="s2">"Spain"</span><span class="p">,</span><span class="w">
  </span><span class="err">nr_tourdefrance_won:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="err">teams:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Discovery Channel"</span><span class="p">,</span><span class="s2">"Astana"</span><span class="p">,</span><span class="s2">"Saxo Bank"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Bernard Hinault"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_of_birth:</span><span class="w"> </span><span class="s2">"1954-11-14"</span><span class="p">,</span><span class="w">
  </span><span class="err">country:</span><span class="w"> </span><span class="s2">"France"</span><span class="p">,</span><span class="w">
  </span><span class="err">nr_tourdefrance_won:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="err">teams:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Gitane"</span><span class="p">,</span><span class="s2">"Renault"</span><span class="p">,</span><span class="s2">"La Vie Claire"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span></code></pre></figure>

<h2 id="inverse-referencing-pattern">Inverse referencing pattern</h2>
<p>This is what we saw in the data modelling section for 1-to-immense relationships. Instead of e.g. storing log messages in a server document, store the server in the log messages:</p>

<p><code class="language-plaintext highlighter-rouge">servers</code> collection:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">location:</span><span class="w"> </span><span class="s2">"server room 2"</span><span class="w"> </span><span class="p">}</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">logs</code> collections:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:29"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:35"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:37"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:39"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:39"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:42"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:39"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"Failed to bootstrap path  /System/Library, error = 2: No such file or directory"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"Oct 14 07:50:43"</span><span class="p">,</span><span class="w"> </span><span class="err">host:</span><span class="w"> </span><span class="s2">"server_17"</span><span class="p">,</span><span class="w">
  </span><span class="err">message:</span><span class="w"> </span><span class="s2">"com.apple.xpc.launchd[1] &lt;Notice&gt;: Service exited due to SIGKILL"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span></code></pre></figure>

<div class="seriesContext">
  
  
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
  
  

  
    <a href="nosql-difference-with-keyvalue-stores.html"><button type="button" class="btn btn-primary">Next: Difference with key/value stores</button></a>
  
</div>



    <div class="tags">
        
    </div>




</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2021 Visual Data Analysis Lab. All rights reserved. <br />
 Site last generated: Nov 22, 2021 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>

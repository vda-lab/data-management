<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" nosql">
<title>Concepts | Data Management</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-custom.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="data-management" href="http://localhost:4000/feed.xml">

<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Data Management</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/vda-lab/data-management" target="_blank" rel="noopener">GitHub</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="rdbms_landing_page.html">Relational databases and SQL</a></li>
                        
                        
                        
                        <li><a href="nosql_landing_page.html">NoSQL</a></li>
                        
                        
                        
                        <li><a href="lambda_landing_page.html">Lambda architecture</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Concepts">{title}</a></li>',
                    noResultsText: '',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">NoSQL databases </li>
  
  
  
      
  
      
  
  <li>
      <a title="Issues with relational databases" href="#">Issues with relational databases</a>
      <ul>
          
          
          
          <li><a title="Scalability and clusters" href="nosql-scalability-and-clusters.html">Scalability and clusters</a></li>
          
          
          
          
          
          
          <li><a title="Impedance mismatch" href="nosql-impedance-mismatch.html">Impedance mismatch</a></li>
          
          
          
          
          
          
          <li><a title="Relational data" href="nosql-relational-data.html">Relational data</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="General NoSQL concepts" href="#">General NoSQL concepts</a>
      <ul>
          
          
          
          <li><a title="General NoSQL concepts" href="nosql-general-concepts.html">General NoSQL concepts</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Intermezzo - JSON" href="#">Intermezzo - JSON</a>
      <ul>
          
          
          
          <li><a title="Intermezzo - JSON" href="nosql-intermezzo-json.html">Intermezzo - JSON</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Key/value stores" href="#">Key/value stores</a>
      <ul>
          
          
          
          <li><a title="Key/value stores" href="nosql-keyvalue-stores.html">Key/value stores</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Document-oriented databases" href="#">Document-oriented databases</a>
      <ul>
          
          
          
          <li><a title="Introduction" href="nosql-document-databases-introduction.html">Introduction</a></li>
          
          
          
          
          
          
          <li class="active"><a title="Concepts" href="nosql-document-databases-concepts.html">Concepts</a></li>
          
          
          
          
          
          
          <li><a title="Data modelling" href="nosql-document-databases-data-modelling.html">Data modelling</a></li>
          
          
          
          
          
          
          <li><a title="Data modelling patterns" href="nosql-document-databases-data-modelling-patterns.html">Data modelling patterns</a></li>
          
          
          
          
          
          
          <li><a title="Difference with key/value stores" href="nosql-difference-with-keyvalue-stores.html">Difference with key/value stores</a></li>
          
          
          
          
          
          
          <li><a title="Implementations" href="nosql-document-databases-implementations.html">Implementations</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="Graph databases" href="#">Graph databases</a>
      <ul>
          
          
          
          <li><a title="Introduction" href="nosql-graph-databases-introduction.html">Introduction</a></li>
          
          
          
          
          
          
          <li><a title="Nomenclature" href="nosql-graph-databases-nomenclature.html">Nomenclature</a></li>
          
          
          
          
          
          
          <li><a title="Centralities" href="nosql-graph-databases-centralities.html">Centralities</a></li>
          
          
          
          
          
          
          <li><a title="Graph mining" href="nosql-graph-databases-mining.html">Graph mining</a></li>
          
          
          
          
          
          
          <li><a title="Data modelling" href="nosql-graph-databases-data-modelling.html">Data modelling</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="ArangoDB" href="#">ArangoDB</a>
      <ul>
          
          
          
          <li><a title="A multi-model database" href="nosql-arangodb-multimodel-database.html">A multi-model database</a></li>
          
          
          
          
          
          
          <li><a title="Starting with ArangoDB" href="nosql-starting-with-arangodb.html">Starting with ArangoDB</a></li>
          
          
          
          
          
          
          <li><a title="Loading data" href="nosql-arangodb-loading-data.html">Loading data</a></li>
          
          
          
          
          
          
          <li><a title="Querying key/value data" href="nosql-arangodb-querying-keyvalue-data.html">Querying key/value data</a></li>
          
          
          
          
          
          
          <li><a title="Querying document data" href="nosql-arangodb-querying-document-data.html">Querying document data</a></li>
          
          
          
          
          
          
          <li><a title="Querying graph data" href="nosql-arangodb-querying-graph-data.html">Querying graph data</a></li>
          
          
          
          
          
          
          <li><a title="Improving performance" href="nosql-arangodb-improving-performance.html">Improving performance</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="ArangoDB APIs" href="#">ArangoDB APIs</a>
      <ul>
          
          
          
          <li><a title="APIs" href="nosql-arangodb-apis.html">APIs</a></li>
          
          
          
          
          
          
          <li><a title="ArangoDB and R" href="nosql-arangodb-and-r.html">ArangoDB and R</a></li>
          
          
          
          
          
          
          <li><a title="ArangoDB and python" href="nosql-arangodb-and-python.html">ArangoDB and python</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block: -->
         <!-- <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p> -->

</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">Concepts</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

   <div class="seriesContext">
  
  
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
  
  

  
    <a href="nosql-document-databases-introduction.html"><button type="button" class="btn btn-primary">Previous: Introduction</button></a>
  
</div>

<h2 id="naming-things-collections-and-documents">Naming things: collections and documents</h2>
<p>The way that things are named in document stores is a bit different than in RDBMS, but in general a <em>collection</em> in a document store corresponds to a <em>table</em> in a RDBMS, and a <em>document</em> corresponds to a <em>row</em>.</p>

<p>As a comparison, consider the following examples of a relational database vs a document database for storing blog data.</p>

<h3 id="blog-information-stored-in-rdbms">Blog information stored in RDBMS</h3>

<p><em>Table</em> <code class="language-plaintext highlighter-rouge">posts</code></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>author_id</th>
      <th>date</th>
      <th>title</th>
      <th>text</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>4</td>
      <td>4-5-2020</td>
      <td>COVID-19 lockdown</td>
      <td>It seems that…</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>5-5-2020</td>
      <td>Schools closed</td>
      <td>As the number of COVID-19 cases is growing, …</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
    </tr>
  </tbody>
</table>

<p><em>Table</em> <code class="language-plaintext highlighter-rouge">authors</code></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>email</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Santa Claus</td>
      <td>santa.claus@northpole.org</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Easter Bunny</td>
      <td>easterbunny@easter.org</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
    </tr>
  </tbody>
</table>

<p>Each <em>table</em> has <em>rows</em>.</p>

<h3 id="blog-information-stored-in-document-database">Blog information stored in document database</h3>

<p><em>Collection</em> <code class="language-plaintext highlighter-rouge">posts</code></p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"COVID-19 lockdown"</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"4-5-2020"</span><span class="p">,</span><span class="w">
  </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Geert Molenberghs"</span><span class="p">,</span><span class="w"> </span><span class="err">email:</span><span class="w"> </span><span class="s2">"geert@gmail.com"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="err">text:</span><span class="w"> </span><span class="s2">"It seems that..."</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"Schools closed"</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="s2">"5-5-2020"</span><span class="p">,</span><span class="w">
  </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Geert Molenberghs"</span><span class="p">,</span><span class="w"> </span><span class="err">email:</span><span class="w"> </span><span class="s2">"geert@gmail.com"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="err">text:</span><span class="w"> </span><span class="s2">"As the number of COVID-19 cases is growing, ..."</span><span class="p">}</span></code></pre></figure>

<p>This is <em>one</em> <em>collection</em> with two <em>documents</em>.</p>

<h2 id="documents-are-schemaless">Documents are schemaless</h2>
<p>As mentioned <a href="/nosql-general-concepts.html">before</a>, one of the important differences between RDBMS and document databases, is that documents are <em>schemaless</em>. Actually, we should say that they have a <em>flexible schema</em>. What does this mean? Consider the case where we are collecting data on bird migrations (as for example <a href="https://www.belgianbirdalerts.be/">https://www.belgianbirdalerts.be/</a>). In an RDMBS, we could put this information in a <code class="language-plaintext highlighter-rouge">sightings</code> table.</p>

<p><small><i>sightings</i></small></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>species_la</th>
      <th>species_en</th>
      <th>date_time</th>
      <th>municipality</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Emberiza pusilla</td>
      <td>Little Bunting</td>
      <td>Dwerggors</td>
      <td>30-09-2020 15:37</td>
      <td>Zeebrugge, BE</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Sylvia nisoria</td>
      <td>Barred Warbler</td>
      <td>Sperwergrasmus</td>
      <td>2020-10-01 13:45</td>
      <td>Zeebrugge, BE</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>What if we want to store the Dutch name as well? Then we’d need to alter the table schema to have a new column to hold that information: <code class="language-plaintext highlighter-rouge">ALTER TABLE sightings ADD species_du TEXT;</code>. After adding this column and updating the value in that particular column, we get the following:</p>

<p><small><i>sightings</i></small></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>species_la</th>
      <th>species_en</th>
      <th>species_du</th>
      <th>date_time</th>
      <th>municipality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Emberiza pusilla</td>
      <td>Little Bunting</td>
      <td>Dwerggors</td>
      <td>30-09-2020 15:37</td>
      <td>Zeebrugge, BE</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Sylvia nisoria</td>
      <td>Barred Warbler</td>
      <td>Sperwergrasmus</td>
      <td>2020-10-01 13:45</td>
      <td>Zeebrugge, BE</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>So far so good: this table still looks clean. Now imagine that we want to improve the reporting, and actually include the longitude and latitude instead of just the municipality. Also, we want to split up the date from the time. To do this, we have to alter the schema of the <code class="language-plaintext highlighter-rouge">sightings</code> table to include these new columns. Only after we changed this schema, we can input data using the new information:</p>

<p><small><i>sightings</i></small></p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>species_la</th>
      <th>species_en</th>
      <th>species_du</th>
      <th>date_time</th>
      <th>municipality</th>
      <th>date</th>
      <th>time</th>
      <th>lat</th>
      <th>long</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Emberiza pusilla</td>
      <td>Little Bunting</td>
      <td>Dwerggors</td>
      <td>30-09-2020 15:37</td>
      <td>Zeebrugge, BE</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>2</td>
      <td>Sylvia nisoria</td>
      <td>Barred Warbler</td>
      <td>Sperwergrasmus</td>
      <td>2020-10-01 13:45</td>
      <td>Zeebrugge, BE</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>56</td>
      <td>Elanus caeruleus</td>
      <td>Black-winged Kite</td>
      <td>Grijze Wouw</td>
      <td> </td>
      <td> </td>
      <td>2020-10-02</td>
      <td>15:15</td>
      <td>50.96577</td>
      <td>3.92744</td>
    </tr>
    <tr>
      <td>57</td>
      <td>Ficedula parva</td>
      <td>Red-breasted Flycatcher</td>
      <td>Kleine Vliegenvanger</td>
      <td> </td>
      <td> </td>
      <td>2020-10-04</td>
      <td>10:34</td>
      <td>51.33501</td>
      <td>3.23154</td>
    </tr>
    <tr>
      <td>58</td>
      <td>Phalaropus lobatus</td>
      <td>Red-necked Phalarope</td>
      <td>Grauwe Franjepoot</td>
      <td> </td>
      <td> </td>
      <td>2020-10-04</td>
      <td>10:48</td>
      <td>51.14660</td>
      <td>2.73363</td>
    </tr>
    <tr>
      <td>59</td>
      <td>Locustella certhiola</td>
      <td>Pallas’s Grasshopper Warbler</td>
      <td>Siberische Sprinkhaanzanger</td>
      <td> </td>
      <td> </td>
      <td>2020-10-04</td>
      <td>11:53</td>
      <td>51.33950</td>
      <td>3.22775</td>
    </tr>
    <tr>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td>…</td>
      <td> </td>
      <td> </td>
      <td>…</td>
      <td>…</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>Executing an <code class="language-plaintext highlighter-rouge">ALTER TABLE</code> on a relational database is a <em>huge</em> step. Having a well-defined schema is core to a RDBMS, so changing it should not be done lightly.</p>

<p>In contrast, nothing would need to be done to store this new information if we had been using a document-database. Consider our initial data:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">species_la:</span><span class="w"> </span><span class="s2">"Emberiza pusilla"</span><span class="p">,</span><span class="w"> </span><span class="err">species_en:</span><span class="w"> </span><span class="s2">"Little Bunting"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_time:</span><span class="w"> </span><span class="s2">"30-09-2020 15:37"</span><span class="p">,</span><span class="w"> </span><span class="err">municipality:</span><span class="w"> </span><span class="s2">"Zeebrugge, BE"</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="err">species_la:</span><span class="w"> </span><span class="s2">"Sylvia nisoria"</span><span class="p">,</span><span class="w"> </span><span class="err">species_en:</span><span class="w"> </span><span class="s2">"Barred Warbler"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_time:</span><span class="w"> </span><span class="s2">"2020-10-01 13:45"</span><span class="p">,</span><span class="w"> </span><span class="err">municipality:</span><span class="w"> </span><span class="s2">"Zeebrugge, BE"</span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span></code></pre></figure>

<p>If we want to change from reporting municipality to latitude and longitude, we just add those instead on new documents:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="err">species_la:</span><span class="w"> </span><span class="s2">"Emberiza pusilla"</span><span class="p">,</span><span class="w"> </span><span class="err">species_en:</span><span class="w"> </span><span class="s2">"Little Bunting"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_time:</span><span class="w"> </span><span class="s2">"30-09-2020 15:37"</span><span class="p">,</span><span class="w"> </span><span class="err">municipality:</span><span class="w"> </span><span class="s2">"Zeebrugge, BE"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="err">species_la:</span><span class="w"> </span><span class="s2">"Sylvia nisoria"</span><span class="p">,</span><span class="w"> </span><span class="err">species_en:</span><span class="w"> </span><span class="s2">"Barred Warbler"</span><span class="p">,</span><span class="w">
  </span><span class="err">date_time:</span><span class="w"> </span><span class="s2">"2020-10-01 13:45"</span><span class="p">,</span><span class="w"> </span><span class="err">municipality:</span><span class="w"> </span><span class="s2">"Zeebrugge, BE"</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">56</span><span class="p">,</span><span class="w">
  </span><span class="err">species_la:</span><span class="w"> </span><span class="s2">"Elanus caeruleus"</span><span class="p">,</span><span class="w"> </span><span class="err">species_en:</span><span class="w"> </span><span class="s2">"Black-winged Kite"</span><span class="p">,</span><span class="w"> </span><span class="err">species_du:</span><span class="w"> </span><span class="s2">"Grijze Wouw"</span><span class="p">,</span><span class="w">
  </span><span class="err">date:</span><span class="w"> </span><span class="s2">"2020-10-02"</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"15:15"</span><span class="p">,</span><span class="w">
  </span><span class="err">lat:</span><span class="w"> </span><span class="mf">50.96577</span><span class="p">,</span><span class="w"> </span><span class="err">long:</span><span class="w"> </span><span class="mf">3.92744</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">57</span><span class="p">,</span><span class="w">
  </span><span class="err">species_la:</span><span class="w"> </span><span class="s2">"Ficedula parva"</span><span class="p">,</span><span class="w"> </span><span class="err">species_en:</span><span class="w"> </span><span class="s2">"Red-breasted Flycatcher"</span><span class="p">,</span><span class="w"> </span><span class="err">species_du:</span><span class="w"> </span><span class="s2">"Kleine Vliegenvanger"</span><span class="p">,</span><span class="w">
  </span><span class="err">date:</span><span class="w"> </span><span class="s2">"2020-10-04"</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"10:34"</span><span class="p">,</span><span class="w">
  </span><span class="err">lat:</span><span class="w"> </span><span class="mf">51.33501</span><span class="p">,</span><span class="w"> </span><span class="err">long:</span><span class="w"> </span><span class="mf">3.23154</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="err">...</span></code></pre></figure>

<h3 id="explicit-vs-implicit-schema">Explicit vs implicit schema</h3>
<p>Important: Even though a document database does not enforce a strict schema, there is still an <em>implicit schema</em>: it’s the combination of keys and possible values that can be present in a document. The application (or you) need to know that the English species name is stored with the key <code class="language-plaintext highlighter-rouge">species_en</code>. It should not be a mix of <code class="language-plaintext highlighter-rouge">species_en</code> in some cases, <code class="language-plaintext highlighter-rouge">species_english</code> in others, or <code class="language-plaintext highlighter-rouge">english_name</code> or <code class="language-plaintext highlighter-rouge">english_species_name</code>, etc. That would make it impossible to for example get a list of all species that were sighted.</p>

<h2 id="embedding-vs-referencing">Embedding vs referencing</h2>
<p>When modelling data in a relational database, we typically try to create a <em>normalised database schema</em>. In such schema, different concepts are stored in different tables, and information is linked by referencing rows in different tables.</p>

<p>Consider the example of a blog. This information concerns different concepts: the blog itself, posts on that blog, authors, comments, and tags. This can be modelled like this in a relational database:</p>

<p><img src="/assets/blog_rdbms_schema.png" width="300px" /></p>

<p>Each concept is stored in a separate table. To get all comments on posts written by John Doe, we can do this (we won’t go into actual schemas here):</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">c</span><span class="p">.</span><span class="nb">date</span><span class="p">,</span> <span class="k">c</span><span class="p">.</span><span class="k">comment</span>
<span class="k">FROM</span> <span class="n">authors</span> <span class="n">a</span><span class="p">,</span> <span class="n">blog_entries</span> <span class="n">b</span><span class="p">,</span> <span class="n">comments</span> <span class="k">c</span>
<span class="k">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">author_id</span>
<span class="k">AND</span> <span class="n">b</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">c</span><span class="p">.</span><span class="n">entry_id</span>
<span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nv">"John Doe"</span><span class="p">;</span></code></pre></figure>

<p>In document databases, we have to find a balance between <em>embedding</em> and <em>referencing</em>.</p>

<p>On the one extreme end, we can follow the same approach as in relational databases, and create a separate collection for each concept. So there would be a collection for <code class="language-plaintext highlighter-rouge">blogs</code>, one for <code class="language-plaintext highlighter-rouge">blog_entries</code>, for <code class="language-plaintext highlighter-rouge">authors</code>, for <code class="language-plaintext highlighter-rouge">comments</code> and <code class="language-plaintext highlighter-rouge">tags</code>. At the other extreme end, we can <em>embed</em> some of this information. For example, a single blog entry can have the author name and email, the comments and tags <em>inside</em> it.</p>

<p>A referencing-heavy approach:</p>

<p><img src="/assets/joining.png" width="300px" /></p>

<p>A mixed reference-embed approach:</p>

<p><img src="/assets/linking-embedding.png" width="400px" /></p>

<h3 id="on-cross-collection-queries">On cross-collection queries</h3>
<p>In many document database-implementations (e.g. mongodb) it is not possible to query across collections, which can make using referenced data much more difficult. A query in mongodb, for example, will look like this (don’t worry about the exact syntax; it should be clear what this tries to do):</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="err">db.comments.find(</span><span class="p">{</span><span class="err">author_id:</span><span class="w"> </span><span class="mi">5</span><span class="p">}</span><span class="err">)</span></code></pre></figure>

<p>This will return all comments written by the author with ID 5. To get all comments on posts written by author John Doe we would have to do the following if we’d use a full referencing approach:</p>
<ul>
  <li>Find out what the ID is of “John Doe”: <code class="language-plaintext highlighter-rouge">db.authors.find({name: "John Doe"})</code>. Let’s say that this returns the document <code class="language-plaintext highlighter-rouge">{id: 8, name: "John Doe", twitter: "JohnDoe18272"}</code>.</li>
  <li>Find all blog entries written by him: <code class="language-plaintext highlighter-rouge">db.blog_entries.find({author_id: 8})</code>. Let’s say that this returns the following list of blog posts:</li>
</ul>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[{</span><span class="err">id:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="err">author_id:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="mi">2020-08-17</span><span class="p">,</span><span class="w">
  </span><span class="err">title:</span><span class="w"> </span><span class="s2">"A nice vacation"</span><span class="p">,</span><span class="w"> </span><span class="err">text:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">},</span><span class="w">
 </span><span class="p">{</span><span class="err">id:</span><span class="w"> </span><span class="mi">507</span><span class="p">,</span><span class="w"> </span><span class="err">author_id:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="err">date:</span><span class="w"> </span><span class="mi">2020-08-23</span><span class="p">,</span><span class="w">
  </span><span class="err">title:</span><span class="w"> </span><span class="s2">"How I broke my leg"</span><span class="p">,</span><span class="w"> </span><span class="err">text:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">}]</span></code></pre></figure>

<ul>
  <li>Find all the comments that are linked to one of these posts: <code class="language-plaintext highlighter-rouge">db.comments.find({blog_entry_id: [26,507]})</code>.</li>
</ul>

<p>As you can see, we need 3 different queries to get that information, which means that the database is accessed 3 times. In contrast, with embedding all the relevant information can be extracted with just a single query. Let’s say that information is stored like this:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[{</span><span class="err">id:</span><span class="w"> </span><span class="mi">26</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"JohnDoe18272"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="err">date:</span><span class="w"> </span><span class="mi">2020-08-17</span><span class="p">,</span><span class="w">
  </span><span class="err">title:</span><span class="w"> </span><span class="s2">"A nice vacation"</span><span class="p">,</span><span class="w"> </span><span class="err">text:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
  </span><span class="err">comments:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="err">date:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
              </span><span class="p">{</span><span class="err">date:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}}</span><span class="w">
  </span><span class="err">]</span><span class="p">},</span><span class="w">
 </span><span class="p">{</span><span class="err">id:</span><span class="w"> </span><span class="mi">507</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"JohnDoe18272"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="err">date:</span><span class="w"> </span><span class="mi">2020-08-23</span><span class="p">,</span><span class="w">
  </span><span class="err">title:</span><span class="w"> </span><span class="s2">"How I broke my leg"</span><span class="p">,</span><span class="w"> </span><span class="err">text:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
  </span><span class="err">comments:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="err">date:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
              </span><span class="p">{</span><span class="err">date:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}}</span><span class="w">
  </span><span class="err">]</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="err">id:</span><span class="w"> </span><span class="mi">507</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Superman"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"Clark"</span><span class="w"> </span><span class="p">},</span><span class="w">
   </span><span class="err">date:</span><span class="w"> </span><span class="mi">2020-09-03</span><span class="p">,</span><span class="w">
   </span><span class="err">title:</span><span class="w"> </span><span class="s2">"A view from the sky"</span><span class="p">,</span><span class="w"> </span><span class="err">text:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
   </span><span class="err">comments:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="err">date:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">},</span><span class="w">
               </span><span class="p">{</span><span class="err">date:</span><span class="w"> </span><span class="err">...</span><span class="p">,</span><span class="w"> </span><span class="err">author:</span><span class="w"> </span><span class="p">{</span><span class="err">...</span><span class="p">}}</span><span class="w">
   </span><span class="err">]</span><span class="p">},</span><span class="w">
   </span><span class="err">...</span><span class="w">
</span><span class="p">]</span></code></pre></figure>

<p>Now to get all comments on posts written by John Doe, you only need a single query: <code class="language-plaintext highlighter-rouge">db.blog_entries.find({name:"John Doe"})</code> and therefore a single trip to the database.</p>

<p>BTW: Notice how the author information is duplicated in this example. Again: find a <em>balance</em> between linking and embedding…</p>

<h3 id="document-databases-are-often-aggregation-oriented">Document-databases are often aggregation-oriented</h3>
<p>This possibility for embedding makes that document databases have an aspect of aggregation-orientation to them. Whereas in RDBMS new information is pulled apart and stored in different tables, in a document database all this information can be stored together.</p>

<p>For example, consider a system that needs to store genotyping information. With genotyping, part of an person’s DNA is read and an A, C, T or G is assigned to particular positions in the genome (single nucleotide polymorphisms or SNPs). In a relational database model, it looks like this:</p>

<p><img src="/assets/primary_foreign_keys.png" alt="primary and foreign keys" /></p>

<p><code class="language-plaintext highlighter-rouge">individuals</code> table:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">id</th>
      <th style="text-align: left">name</th>
      <th style="text-align: left">ethnicity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: left">individual_A</td>
      <td style="text-align: left">caucasian</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td style="text-align: left">individual_B</td>
      <td style="text-align: left">caucasian</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">snps</code> table:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">id</th>
      <th style="text-align: left">name</th>
      <th style="text-align: left">chromosome</th>
      <th style="text-align: left">position</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: left">rs12345</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">12345</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td style="text-align: left">rs98765</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">98765</td>
    </tr>
    <tr>
      <td style="text-align: left">3</td>
      <td style="text-align: left">rs28465</td>
      <td style="text-align: left">5</td>
      <td style="text-align: left">23456</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">genotypes</code> table:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">id</th>
      <th style="text-align: left">snp_id</th>
      <th style="text-align: left">individual_id</th>
      <th style="text-align: left">genotype</th>
      <th style="text-align: left">ambiguity_code</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">A/A</td>
      <td style="text-align: left">A</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">A/G</td>
      <td style="text-align: left">R</td>
    </tr>
    <tr>
      <td style="text-align: left">3</td>
      <td style="text-align: left">3</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">G/T</td>
      <td style="text-align: left">K</td>
    </tr>
    <tr>
      <td style="text-align: left">4</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">A/C</td>
      <td style="text-align: left">M</td>
    </tr>
    <tr>
      <td style="text-align: left">5</td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">G/G</td>
      <td style="text-align: left">G</td>
    </tr>
    <tr>
      <td style="text-align: left">6</td>
      <td style="text-align: left">3</td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">G/G</td>
      <td style="text-align: left">G</td>
    </tr>
  </tbody>
</table>

<p>To get all information for <code class="language-plaintext highlighter-rouge">individual_A</code> we need to write a join that gets information from different tables:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">i</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">chromosome</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="k">position</span><span class="p">,</span> <span class="k">g</span><span class="p">.</span><span class="n">genotype</span>
<span class="k">FROM</span> <span class="n">individuals</span> <span class="n">i</span><span class="p">,</span> <span class="n">snps</span> <span class="n">s</span><span class="p">,</span> <span class="n">genotypes</span> <span class="k">g</span>
<span class="k">WHERE</span> <span class="n">i</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">g</span><span class="p">.</span><span class="n">individual_id</span>
<span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">g</span><span class="p">.</span><span class="n">snp_id</span>
<span class="k">AND</span> <span class="n">i</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'individual_A'</span><span class="p">;</span></code></pre></figure>

<p>In a document database, we can store this by individual, for example in a <code class="language-plaintext highlighter-rouge">genotype_documents</code> collection:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_A"</span><span class="p">,</span><span class="w"> </span><span class="err">ethnicity:</span><span class="w"> </span><span class="s2">"caucasian"</span><span class="p">,</span><span class="w">
         </span><span class="err">genotypes:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs12345"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"A/A"</span><span class="w"> </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs9876"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">9876</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"A/G"</span><span class="w"> </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs28465"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">23456</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"G/T"</span><span class="w"> </span><span class="p">}]}</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_B"</span><span class="p">,</span><span class="w"> </span><span class="err">ethnicity:</span><span class="w"> </span><span class="s2">"caucasian"</span><span class="p">,</span><span class="w">
         </span><span class="err">genotypes:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs12345"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"A/C"</span><span class="w"> </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs9876"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">9876</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"G/G"</span><span class="w"> </span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs28465"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">23456</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"G/G"</span><span class="w"> </span><span class="p">}]}</span></code></pre></figure>

<p>In this case, it is much easier to get all information for <code class="language-plaintext highlighter-rouge">individual_A</code>. Such query could simply be: <code class="language-plaintext highlighter-rouge">db.genotype_documents({name: 'individual_A'})</code>. This is because <strong><em>all data is aggregated by individual</em></strong>.</p>

<p>But what if we want all genotypes that were recorded for SNP <code class="language-plaintext highlighter-rouge">rs9876</code> across all individuals? In SQL, the query would be very similar to the one for <code class="language-plaintext highlighter-rouge">individual_A</code>:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">i</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">ethnicity</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">chromosome</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="k">position</span><span class="p">,</span> <span class="k">g</span><span class="p">.</span><span class="n">genotype</span>
<span class="k">FROM</span> <span class="n">individuals</span> <span class="n">i</span><span class="p">,</span> <span class="n">snps</span> <span class="n">s</span><span class="p">,</span> <span class="n">genotypes</span> <span class="k">g</span>
<span class="k">WHERE</span> <span class="n">i</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">g</span><span class="p">.</span><span class="n">individual_id</span>
<span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="k">g</span><span class="p">.</span><span class="n">snp_id</span>
<span class="k">AND</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'rs9876'</span><span class="p">;</span></code></pre></figure>

<p>We do however loose the advantage of the individual-centric model completely with our document database: a query (although it might look simple) will have to extract a little piece of information from every single document in the database which is extremely costly. If we knew we were going to ask this question, it’d have been better to model the data like this:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs12345"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">12345</span><span class="p">,</span><span class="w">
         </span><span class="err">genotypes:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_A"</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"A/A"</span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_B"</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"A/C"</span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs9876"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">9876</span><span class="p">,</span><span class="w">
         </span><span class="err">genotypes:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_A"</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"A/G"</span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_B"</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"G/G"</span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="err">,</span><span class="w">
</span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"rs28465"</span><span class="p">,</span><span class="w"> </span><span class="err">chromosome:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">position:</span><span class="w"> </span><span class="mi">23456</span><span class="p">,</span><span class="w">
         </span><span class="err">genotypes:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_A"</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"G/T"</span><span class="p">},</span><span class="w">
                      </span><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"individual_B"</span><span class="p">,</span><span class="w"> </span><span class="err">genotype:</span><span class="w"> </span><span class="s2">"G/G"</span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span></code></pre></figure>

<p>So do you model your data by individual or by SNP? That depends…</p>

<ul>
  <li>If you know beforehand that you’ll be querying by individual and not by SNP, use the first version.</li>
  <li>If by SNP, use the latter.</li>
  <li>You could model in a similar way as the relational database with separate collections for <code class="language-plaintext highlighter-rouge">individuals</code>, <code class="language-plaintext highlighter-rouge">snps</code> and <code class="language-plaintext highlighter-rouge">genotypes</code>. In other words: using linking rather than embedding.</li>
  <li>You could do <em>both</em>, but not as the master dataset. In this case, you have a master dataset from which you recalculate these two different versions of the same data on a regular basis (daily, weekly, …, depending on the update frequency). This latter approach fits in the Lambda Architecture that we’ll talk about later.</li>
</ul>

<h2 id="homogeneous-vs-heterogeneous-collections">Homogeneous vs heterogeneous collections</h2>
<p>Now should every collection be about one specific thing, or not? Above, we asked the question if every concept should be separate in their own collection or if we want to embed information, or if we want to merge different objects into a single document. Still, the documents within a collection would still be the same. Whether or not we embed the author information in the blog entries, the <code class="language-plaintext highlighter-rouge">blog_entries</code> collection is still about blog entries.</p>

<p>This is however not mandatory, and nothing keeps you from putting all kinds of documents all together in the same collection. Consider the example of a large multi-day conference with many speakers, who hold different talks in different rooms.</p>

<h3 id="homogeneous-design">Homogeneous design</h3>
<p>In a homogeneous design, we put our speakers, rooms and talks in different collections:</p>

<p><em>speakers</em></p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"JohnDoe18272"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Superman"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"Clark"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<p><em>rooms</em></p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"1st floor left"</span><span class="p">,</span><span class="w"> </span><span class="err">floor:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">capacity:</span><span class="w"> </span><span class="mi">80</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"lecture hall 2"</span><span class="p">,</span><span class="w"> </span><span class="err">floor:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">capacity:</span><span class="w"> </span><span class="mi">200</span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<p><em>talks</em></p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"10am"</span><span class="p">,</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"Fun with deep learning"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"2pm"</span><span class="p">,</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"How I solved world hunger"</span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<h3 id="heterogeneous-design">Heterogeneous design</h3>
<p>The above is a perfectly valid approach for storing this type of data. In some cases, however, you might anticipate that you often want to have information from different types. Let’s say that you expect to want to find everything that is related to room 4. In the above setup, you’d have to run 3 different queries; one for each collection.</p>

<p>Another approach is to actually put all that information together. To make sure that we can still query specific types of information (e.g. just the speakers), let’s add an additional key <code class="language-plaintext highlighter-rouge">type</code> (can be anything). Let’s call the collection <code class="language-plaintext highlighter-rouge">agenda</code>:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"speaker"</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"JohnDoe18272"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"speaker"</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"Superman"</span><span class="p">,</span><span class="w"> </span><span class="err">twitter:</span><span class="w"> </span><span class="s2">"Clark"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"room"</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"1st floor left"</span><span class="p">,</span><span class="w"> </span><span class="err">floor:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">capacity:</span><span class="w"> </span><span class="mi">80</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"room"</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"lecture hall 2"</span><span class="p">,</span><span class="w"> </span><span class="err">floor:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">capacity:</span><span class="w"> </span><span class="mi">200</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"talk"</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"10am"</span><span class="p">,</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"Fun with deep learning"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"talk"</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"2pm"</span><span class="p">,</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"How I solved world hunger"</span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<p>Now to get all information available for room with ID 2, we just get <code class="language-plaintext highlighter-rouge">db.agenda.find({room_id: 2})</code> which will return speakers, rooms and talks:</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"room"</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="s2">"lecture hall 2"</span><span class="p">,</span><span class="w"> </span><span class="err">floor:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">capacity:</span><span class="w"> </span><span class="mi">200</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="err">id:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="err">type:</span><span class="w"> </span><span class="s2">"talk"</span><span class="p">,</span><span class="w"> </span><span class="err">speaker_id:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">room_id:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="err">time:</span><span class="w"> </span><span class="s2">"2pm"</span><span class="p">,</span><span class="w"> </span><span class="err">title:</span><span class="w"> </span><span class="s2">"How I solved world hunger"</span><span class="p">},</span><span class="w">
  </span><span class="err">...</span><span class="w"> </span><span class="p">]</span></code></pre></figure>

<p>To just get the talks that are given in that room (so not the room itself) we just add the additional constraint on <code class="language-plaintext highlighter-rouge">type</code>: <code class="language-plaintext highlighter-rouge">db.agenda.find({room_id: 2, type: "talk"})</code>.</p>

<p><small><i>Source of some of this information: Ryan Crawcour &amp; David Makogon</i></small></p>

<div class="seriesContext">
  
  
  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      
      
  
  

  
    <a href="nosql-document-databases-data-modelling.html"><button type="button" class="btn btn-primary">Next: Data modelling</button></a>
  
</div>



    <div class="tags">
        
    </div>




</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2021 Visual Data Analysis Lab. All rights reserved. <br />
 Site last generated: Nov 22, 2021 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
